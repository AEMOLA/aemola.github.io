<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ú©Ù„Ø§Ø³ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ | PWA</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@latest/dist/font-face.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Ù‡Ù…Ø§Ù† Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ - Ø­Ø°Ù Ù†Ø´Ø¯Ù‡ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Vazir', 'Tahoma', sans-serif;
            background: linear-gradient(145deg, #f4f4f4 0%, #ffffff 100%);
            color: #1e1e1e;
            line-height: 1.5;
            padding: 16px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .container { max-width: 1400px; margin: 0 auto; width: 100%; flex: 1; }
        .header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            color: #d4af37;
            padding: 2rem 1.2rem;
            border-radius: 48px;
            margin-bottom: 30px;
            box-shadow: 0 20px 30px -10px rgba(0, 0, 0, 0.4), inset 0 1px 3px rgba(255, 215, 0, 0.3);
            border-bottom: 4px solid #d4af37;
            text-align: center;
        }
        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            text-shadow: 3px 3px 0 #00000040;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .header h1 img {
            height: 60px;
            margin-left: 15px;
            border-radius: 50%;
            background-color: #d4af37;
            padding: 5px;
        }
        .header h1 i { color: #f0e68c; font-size: 2rem; }
        .header p {
            font-size: 1rem;
            color: #f0e68c;
            border-top: 2px dashed #d4af37;
            border-bottom: 2px dashed #d4af37;
            display: inline-block;
            padding: 0.4rem 1.5rem;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 40px;
        }
        .top-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            justify-content: space-between;
        }
        .datetime-panel {
            background: linear-gradient(145deg, #fff9e6, #fff2d7);
            border: 3px solid #d4af37;
            border-radius: 60px;
            padding: 0.8rem 1.5rem;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: 0 8px 0 #b8860b;
            flex: 2;
            min-width: 280px;
        }
        .date-box, .time-box {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            background: #1a1a1a;
            color: #d4af37;
            padding: 0.5rem 1.5rem;
            border-radius: 40px;
            border: 2px solid #f0e68c;
        }
        .date-box i, .time-box i { color: #f0e68c; }
        .notification-badge {
            background-color: #d4af37;
            color: #1a1a1a;
            padding: 0.5rem 1.5rem;
            border-radius: 40px;
            font-weight: 800;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 0 #8b691f;
        }
        .login-simple {
            background: #1a1a1a;
            border: 2px solid #d4af37;
            border-radius: 50px;
            padding: 0.3rem 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 0 #8b691f;
        }
        .login-simple input {
            background: #333;
            border: 1px solid #d4af37;
            border-radius: 40px;
            padding: 0.4rem 0.8rem;
            color: white;
            width: 100px;
            font-family: 'Vazir', sans-serif;
            font-size: 0.85rem;
        }
        .login-simple input::placeholder { color: #aaa; }
        .login-simple button {
            background: #d4af37;
            border: none;
            border-radius: 40px;
            padding: 0.4rem 1rem;
            font-weight: 700;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }
        .login-simple .logout-btn {
            background: transparent;
            border: 2px solid #d4af37;
            color: #d4af37;
            padding: 0.4rem 1rem;
            border-radius: 40px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.8rem;
        }
        .instruction {
            text-align: center;
            margin-bottom: 24px;
            color: #2a2a2a;
            background: #ffffffcc;
            backdrop-filter: blur(10px);
            padding: 0.8rem 1.2rem;
            border-radius: 60px;
            border: 2px solid #d4af37;
            font-weight: 600;
            font-size: 1rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        .instruction i { color: #b8860b; font-size: 1.3rem; animation: bounce 1.5s infinite; }
        @keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 22px;
        }
        .course-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border-radius: 36px;
            box-shadow: 0 15px 35px -8px rgba(0, 0, 0, 0.2), 0 0 0 1px #d4af37 inset;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: none;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            user-select: none;
            height: fit-content;
            transform: translateZ(0);
            position: relative;
        }
        .course-card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 25px 45px -10px rgba(0, 0, 0, 0.3), 0 0 0 2px #d4af37 inset;
        }
        .admin-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 8px;
            z-index: 10;
        }
        .edit-btn, .delete-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: 0.2s;
            border: 2px solid #d4af37;
        }
        .edit-btn { background: #d4af37; color: #1a1a1a; }
        .delete-btn { background: rgba(0, 0, 0, 0.7); color: #ff4444; }
        .edit-btn:hover { background: #b8860b; color: white; }
        .delete-btn:hover { background: #ff4444; color: white; }
        .online-badge {
            background: #27ae60;
            color: white;
            padding: 0.2rem 1rem;
            border-radius: 40px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-top: 8px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .online-link {
            margin-top: 8px;
            font-size: 0.9rem;
        }
        .online-link a {
            color: #27ae60;
            text-decoration: none;
            background: rgba(39, 174, 96, 0.2);
            padding: 0.2rem 1rem;
            border-radius: 40px;
            border: 1px solid #27ae60;
        }
        .course-card.today-highlight {
            box-shadow: 0 0 0 4px #ffd966, 0 20px 40px -8px #f1c40f, 0 0 0 2px #b8860b inset;
            background: rgba(255, 248, 225, 0.9);
            backdrop-filter: blur(12px);
            transform: scale(1.02);
        }
        .course-card.today-highlight .day-time-badge {
            background: linear-gradient(145deg, #d4af37, #b8860b);
            color: #1a1a1a;
            border-color: #fffacd;
        }
        .course-card.today-highlight .day-time-badge i { color: #1a1a1a; }
        .course-card.today-highlight .summary-course-name {
            background: linear-gradient(145deg, #f7eac6, #f5d76e);
            border-color: #d4af37;
        }
        .card-summary {
            padding: 1.8rem 1rem 1.2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            background: transparent;
            border-radius: 36px 36px 0 0;
        }
        .day-time-badge {
            background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
            color: #d4af37;
            padding: 0.7rem 1.2rem;
            border-radius: 50px;
            font-weight: 800;
            font-size: 1.2rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
            border: 2px solid #d4af37;
            width: 100%;
            justify-content: center;
            box-shadow: 0 5px 0 #8b691f;
        }
        .day-time-badge i { color: #f0e68c; font-size: 1.3rem; filter: drop-shadow(0 2px 2px black); }
        .summary-course-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1e1e1e;
            background: linear-gradient(145deg, #f7eac6, #f5e1a6);
            padding: 0.5rem 1.5rem;
            border-radius: 60px;
            display: inline-block;
            border: 2px solid #b8860b;
            word-break: break-word;
            max-width: 100%;
            box-shadow: 0 4px 0 #a57c1e;
            line-height: 1.4;
        }
        .countdown-area {
            margin-top: 12px;
            width: 100%;
            font-size: 0.9rem;
            font-weight: 600;
            background: rgba(212, 175, 55, 0.15);
            padding: 0.4rem 0.8rem;
            border-radius: 40px;
            border: 1px solid #d4af37;
            color: #1e1e1e;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            backdrop-filter: blur(4px);
        }
        .expand-icon {
            margin-top: 15px;
            color: #b8860b;
            font-size: 1.4rem;
            transition: transform 0.4s;
            background-color: rgba(212, 175, 55, 0.15);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .course-card.expanded .expand-icon i { transform: rotate(180deg); }
        .card-details {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, opacity 0.4s ease-in-out, padding 0.4s;
            background: transparent;
            border-radius: 0 0 36px 36px;
            border-top: 0 solid #d4af37;
        }
        .course-card.expanded .card-details {
            max-height: 900px;
            opacity: 1;
            padding: 1.2rem 1.2rem 1.8rem 1.2rem;
            border-top-width: 3px;
        }
        .details-content { color: #1e1e1e; }
        .course-code {
            background: #1e1e1e;
            color: #d4af37;
            padding: 0.4rem 1.2rem;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 1rem;
            border: 1px solid #d4af37;
        }
        .units-mini {
            display: flex;
            gap: 12px;
            background: #faf3dd;
            padding: 0.6rem 1.2rem;
            border-radius: 40px;
            width: fit-content;
            margin-bottom: 1rem;
            border: 2px solid #d4af37;
            font-size: 0.95rem;
            flex-wrap: wrap;
        }
        .units-mini span { display: flex; align-items: center; gap: 6px; }
        .units-mini i { color: #b8860b; }
        .info-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 0.95rem;
            background: rgba(248, 244, 236, 0.8);
            backdrop-filter: blur(4px);
            padding: 0.7rem 1rem;
            border-radius: 40px;
            border-right: 6px solid #d4af37;
        }
        .info-row i { width: 24px; color: #b8860b; font-size: 1.1rem; }
        .exam-simple {
            margin-top: 1rem;
            background: linear-gradient(145deg, #1e1e1e, #2a2a2a);
            color: #fff;
            padding: 1rem 1.2rem;
            border-radius: 30px;
            border: 2px solid #d4af37;
            box-shadow: 0 8px 0 #8b691f;
        }
        .exam-simple .exam-header {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #d4af37;
            font-weight: 800;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        .exam-detail-item {
            display: flex;
            align-items: baseline;
            gap: 12px;
            margin-right: 6px;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        .exam-detail-item i { width: 20px; color: #d4af37; }
        .exam-date-badge {
            background-color: #d4af37;
            color: #1e1e1e;
            padding: 0.2rem 0.9rem;
            border-radius: 30px;
            font-weight: 800;
            font-size: 0.8rem;
            display: inline-block;
            margin-left: 8px;
            border: 1px solid white;
        }
        .card-footer {
            height: 8px;
            background: linear-gradient(90deg, #b8860b, #f0e68c, #b8860b);
            border-radius: 0 0 36px 36px;
        }
        .add-course-section {
            margin: 40px 0 20px;
            background: linear-gradient(145deg, #fff9e6, #fff2d7);
            border: 3px solid #d4af37;
            border-radius: 60px;
            padding: 1.5rem;
            box-shadow: 0 8px 0 #b8860b;
            display: none;
        }
        .add-course-section.visible { display: block; }
        .add-course-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .form-group label {
            font-weight: 700;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .form-group input, .form-group select, .form-group textarea {
            padding: 10px 15px;
            border-radius: 40px;
            border: 2px solid #d4af37;
            background: white;
            font-family: 'Vazir', sans-serif;
            font-size: 0.9rem;
        }
        .checkbox-group {
            flex-direction: row;
            align-items: center;
            gap: 10px;
        }
        .btn-add, .btn-cancel, .btn-save-sound {
            padding: 10px 25px;
            border-radius: 40px;
            font-weight: 800;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            height: fit-content;
            border: 2px solid #d4af37;
        }
        .btn-add { background: #1a1a1a; color: #d4af37; }
        .btn-cancel { background: #7f8c8d; color: white; border-color: #95a5a6; }
        .btn-save-sound { background: #27ae60; color: white; border-color: #d4af37; }
        .btn-add:hover { background: #d4af37; color: #1a1a1a; }
        .btn-cancel:hover { background: #95a5a6; }
        .btn-save-sound:hover { background: #2ecc71; }
        .sound-settings {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 3px dashed #d4af37;
        }
        .designer-footer {
            margin-top: 50px;
            text-align: center;
            background: linear-gradient(145deg, #1a1a1a, #252525);
            padding: 1.5rem 1.5rem;
            border-radius: 60px 60px 30px 30px;
            border: 3px solid #d4af37;
            box-shadow: 0 -5px 0 #b8860b;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .designer-footer p {
            color: #d4af37;
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        .designer-footer i { color: #f0e68c; font-size: 1.6rem; filter: drop-shadow(0 2px 2px black); }
        .designer-footer .name {
            background-color: #d4af37;
            color: #1a1a1a;
            padding: 0.3rem 1.2rem;
            border-radius: 40px;
            font-weight: 800;
            font-size: 1.2rem;
        }
        .contact-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px dashed #d4af37;
        }
        .contact-info a {
            color: #f0e68c;
            text-decoration: none;
            font-size: 1.1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            padding: 0.4rem 1.2rem;
            border-radius: 40px;
            transition: 0.2s;
            border: 1px solid #d4af37;
        }
        .contact-info a:hover { background: #d4af37; color: #1a1a1a; }
        @media (max-width: 700px) {
            .top-panel { flex-direction: column; align-items: stretch; }
            .login-simple { justify-content: center; }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <img src="/icons/icon-192x192.png" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡" style="height: 60px; margin-left: 15px; border-radius: 50%; background-color: #d4af37; padding: 5px;">
                Ø¨Ø±Ù†Ø§Ù…Ù‡ Ú©Ù„Ø§Ø³ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯
                <i class="fas fa-map-pin"></i>
            </h1>
            <p>ğŸ“ Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ù‡â€ŒØ±ÙˆØ²ØŒ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†</p>
        </div>

        <div class="top-panel">
            <div class="datetime-panel">
                <div class="date-box" id="dateDisplay"><i class="fas fa-calendar-alt"></i> <span>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span></div>
                <div class="time-box" id="timeDisplay"><i class="fas fa-clock"></i> <span>--:--:--</span></div>
                <div class="notification-badge" id="notificationBadge"><i class="fas fa-bell"></i> <span id="notifText">Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§...</span></div>
            </div>

            <div class="login-simple" id="loginContainer">
                <input type="email" id="email" placeholder="Ø§ÛŒÙ…ÛŒÙ„" value="">
                <input type="password" id="password" placeholder="Ø±Ù…Ø²">
                <button onclick="login()"><i class="fas fa-sign-in-alt"></i> ÙˆØ±ÙˆØ¯</button>
                <button class="logout-btn" id="logoutBtn" onclick="logout()" style="display:none;"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>

        <div class="instruction">
            <i class="fas fa-hand-pointer"></i> Ø±ÙˆÛŒ Ù‡Ø± Ú©Ø§Ø±Øª Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ø¯Ø±Ø³ Ø¨Ø§Ø² Ø´ÙˆØ¯ <i class="fas fa-chevron-down"></i>
        </div>

        <div class="card-grid" id="cardGrid"></div>

        <div class="add-course-section" id="adminSection">
            <h3 style="color: #1a1a1a; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-plus-circle" style="color: #b8860b;"></i> <span id="formTitle">Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯</span>
            </h3>
            <div class="add-course-form" id="courseForm">
                <input type="hidden" id="editId" value="">
                <div class="form-group"><label><i class="fas fa-book"></i> Ù†Ø§Ù… Ø¯Ø±Ø³</label><input type="text" id="courseName" placeholder="Ù…Ø«Ø§Ù„: Ø±ÛŒØ§Ø¶ÛŒ"></div>
                <div class="form-group"><label><i class="fas fa-hashtag"></i> Ú©Ø¯ Ø¯Ø±Ø³</label><input type="text" id="courseCode" placeholder="Ù…Ø«Ø§Ù„: Û±Û²Û³Û´"></div>
                <div class="form-group"><label><i class="fas fa-calendar-day"></i> Ø±ÙˆØ² Ù‡ÙØªÙ‡</label>
                    <select id="courseDay"><option value="0">Ø´Ù†Ø¨Ù‡</option><option value="1">ÛŒÚ©â€ŒØ´Ù†Ø¨Ù‡</option><option value="2">Ø¯ÙˆØ´Ù†Ø¨Ù‡</option><option value="3">Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡</option><option value="4">Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡</option><option value="5">Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡</option><option value="6">Ø¬Ù…Ø¹Ù‡</option></select>
                </div>
                <div class="form-group"><label><i class="fas fa-clock"></i> Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹</label><input type="time" id="startTime" value="08:00"></div>
                <div class="form-group"><label><i class="fas fa-clock"></i> Ø³Ø§Ø¹Øª Ù¾Ø§ÛŒØ§Ù†</label><input type="time" id="endTime" value="10:00"></div>
                <div class="form-group"><label><i class="fas fa-chalkboard-teacher"></i> Ø§Ø³ØªØ§Ø¯</label><input type="text" id="professor" placeholder="Ù†Ø§Ù… Ø§Ø³ØªØ§Ø¯"></div>
                <div class="form-group"><label><i class="fas fa-map-marker-alt"></i> Ù…Ú©Ø§Ù†</label><input type="text" id="location" placeholder="Ø¯Ø§Ù†Ø´Ú©Ø¯Ù‡"></div>
                <div class="form-group"><label><i class="fas fa-users-between-lines"></i> Ú¯Ø±ÙˆÙ‡ Ø¯Ø±Ø³ÛŒ</label><input type="text" id="courseGroup" placeholder="Ù…Ø«Ø§Ù„: Û±Û±Û±Û´" value="---"></div>
                <div class="form-group"><label><i class="fas fa-calculator"></i> ÙˆØ§Ø­Ø¯ ØªØ¦ÙˆØ±ÛŒ</label><input type="number" step="0.1" min="0" id="theoretical" value="0.0"></div>
                <div class="form-group"><label><i class="fas fa-calculator"></i> ÙˆØ§Ø­Ø¯ Ø¹Ù…Ù„ÛŒ</label><input type="number" step="0.1" min="0" id="practical" value="0.0"></div>
                <div class="form-group"><label><i class="fas fa-calculator"></i> ÙˆØ§Ø­Ø¯ Ú©Ù„</label><input type="number" step="0.1" min="0" id="total" value="0.0"></div>
                <div class="form-group checkbox-group">
                    <label><i class="fas fa-globe"></i> Ø¢Ù†Ù„Ø§ÛŒÙ†</label>
                    <input type="checkbox" id="isOnline" style="width:20px; height:20px;">
                </div>
                <div class="form-group" id="onlineLinkGroup" style="display:none;">
                    <label><i class="fas fa-link"></i> Ù„ÛŒÙ†Ú© Ø¬Ù„Ø³Ù‡</label>
                    <input type="url" id="onlineLink" placeholder="https://">
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn-add" onclick="saveCourse()"><i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡</button>
                    <button class="btn-cancel" onclick="cancelEdit()"><i class="fas fa-times"></i> Ù„ØºÙˆ</button>
                </div>
            </div>

            <div class="sound-settings">
                <h4 style="color: #1a1a1a; margin-bottom: 15px;"><i class="fas fa-music"></i> ØªÙ†Ø¸ÛŒÙ… ØµØ¯Ø§ÛŒ Ø²Ù†Ú¯</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                    <input type="url" id="bellSoundUrl" placeholder="Ù„ÛŒÙ†Ú© ÙØ§ÛŒÙ„ ØµÙˆØªÛŒ (MP3)" style="flex: 1; min-width: 250px; padding: 10px; border-radius: 40px; border: 2px solid #d4af37;" value="https://bigsoundbank.com/UPLOAD/mp3/1500.mp3">
                    <button class="btn-save-sound" onclick="saveBellSound()"><i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ Ø²Ù†Ú¯</button>
                    <button class="btn-cancel" onclick="playTestBell()"><i class="fas fa-play"></i> ØªØ³Øª Ø²Ù†Ú¯</button>
                </div>
                <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">Ø§Ú¯Ø± ØµØ¯Ø§ Ù¾Ø®Ø´ Ù†Ø´Ø¯ØŒ Ø±ÙˆÛŒ "ØªØ³Øª Ø²Ù†Ú¯" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ Ùˆ Ø³Ù¾Ø³ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ù‡ÛŒØ¯ Ù…Ø±ÙˆØ±Ú¯Ø± ØµØ¯Ø§ Ø±Ø§ Ù¾Ø®Ø´ Ú©Ù†Ø¯.</p>
            </div>
        </div>

        <div class="designer-footer">
            <p><i class="fas fa-paint-brush"></i> Ø·Ø±Ø§Ø­ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡ ØªÙˆØ³Ø· <span class="name">Ù…Ø­Ù…Ø¯ Ù…Ù‡Ø¯ÛŒ Ù…ÙˆÙ„Ø§ÛŒØ§Ø±ÛŒ</span> <i class="fas fa-code"></i></p>
            <div class="contact-info">
                <a href="tel:+989375379205" dir="ltr"><i class="fas fa-phone-alt"></i> 09375379205</a>
                <a href="https://t.me/AE_MOLA" target="_blank"><i class="fab fa-telegram-plane"></i> t.me/AE_MOLA</a>
            </div>
        </div>
    </div>

    <audio id="bellSound" preload="auto"></audio>

    <script>
        (function() {
            const supabaseUrl = 'https://kssamzssqvkmsdgljlem.supabase.co';
            const supabaseAnonKey = 'sb_publishable_-XVb7eOpQzabcePWvfc9NA_x0fXhFSf';
            
            const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey, {
                auth: { persistSession: true, autoRefreshToken: true }
            });

            const TEHRAN_OFFSET = 3.5 * 60 * 60 * 1000;
            let coursesData = [];
            let isLoggedIn = false;
            let bellPlayed = [];
            let unsubscribeCourses = null;
            let unsubscribeSettings = null;
            const bellSound = document.getElementById('bellSound');
            let bellSoundUrl = "https://bigsoundbank.com/UPLOAD/mp3/1500.mp3";

            // ===== ØªÙˆØ§Ø¨Ø¹ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† =====
            function requestNotificationPermission() {
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }

            function scheduleClassNotification(course, minutesBefore = 5) {
                if (!('Notification' in window) || Notification.permission !== 'granted') return;

                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³ (Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÙˆØ² Ùˆ Ø³Ø§Ø¹Øª)
                const now = new Date();
                const tehranNow = now.getTime() + TEHRAN_OFFSET;
                const tehranDate = new Date(tehranNow);
                const currentDay = (tehranDate.getUTCDay() + 1) % 7;
                const currentHour = tehranDate.getUTCHours();
                const currentMin = tehranDate.getUTCMinutes();
                const currentMinutes = currentHour * 60 + currentMin;

                const cardDay = course.dayIndex;
                const startHour = parseInt(course.startTime.split(':')[0]);
                const startMin = parseInt(course.startTime.split(':')[1]);
                const startTotal = startHour*60 + startMin;

                let diffDays = (cardDay - currentDay + 7) % 7;
                if (diffDays === 0 && currentMinutes >= startTotal) diffDays = 7;

                const targetTehran = tehranNow + diffDays * 86400000;
                const targetDate = new Date(targetTehran);
                targetDate.setUTCHours(startHour, startMin, 0, 0);
                const targetTime = targetDate.getTime() - TEHRAN_OFFSET; // Ø¨Ù‡ UTC

                const notificationTime = targetTime - minutesBefore * 60 * 1000;
                const delay = notificationTime - Date.now();

                if (delay > 0 && delay < 7 * 24 * 60 * 60 * 1000) { // Ø­Ø¯Ø§Ú©Ø«Ø± ÛŒÚ© Ù‡ÙØªÙ‡
                    setTimeout(() => {
                        if (navigator.serviceWorker?.controller) {
                            navigator.serviceWorker.controller.postMessage({
                                type: 'SHOW_NOTIFICATION',
                                title: 'ÛŒØ§Ø¯Ø¢ÙˆØ± Ú©Ù„Ø§Ø³',
                                body: `Ú©Ù„Ø§Ø³ ${course.name} ØªØ§ ${minutesBefore} Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø± Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯.`
                            });
                        } else {
                            new Notification('ÛŒØ§Ø¯Ø¢ÙˆØ± Ú©Ù„Ø§Ø³', {
                                body: `Ú©Ù„Ø§Ø³ ${course.name} ØªØ§ ${minutesBefore} Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø± Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯.`,
                                icon: '/icons/icon-192x192.png'
                            });
                        }
                    }, delay);
                }
            }

            // ===== ØªÙˆØ§Ø¨Ø¹ Ú©Ø´ Ø¨Ø±Ø§ÛŒ Ø¢ÙÙ„Ø§ÛŒÙ† =====
            async function loadCoursesWithCache() {
                // Ø§Ø¨ØªØ¯Ø§ Ø§Ø² Ú©Ø´ (localStorage) Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
                const cached = localStorage.getItem('cachedCourses');
                if (cached) {
                    try {
                        coursesData = JSON.parse(cached);
                        renderCards();
                        updateCountdownsAndBell();
                    } catch (e) {}
                }

                // Ø³Ù¾Ø³ Ø§Ø² Ø´Ø¨Ú©Ù‡ Ø¨Ú¯ÛŒØ± Ùˆ Ú©Ø´ Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ² Ú©Ù†
                try {
                    const { data, error } = await supabase
                        .from('courses')
                        .select('*')
                        .order('dayIndex', { ascending: true })
                        .order('startTime', { ascending: true });
                    if (!error && data) {
                        coursesData = data;
                        localStorage.setItem('cachedCourses', JSON.stringify(data));
                        resetBellPlayed();
                        renderCards();
                        updateCountdownsAndBell();

                        // Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ù†ÙˆØªÛŒÙ Ø¨Ø±Ø§ÛŒ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡
                        data.forEach(course => scheduleClassNotification(course));
                    }
                } catch (e) {
                    console.warn('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² Ø´Ø¨Ú©Ù‡ØŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø´ Ø´Ø¯Ù‡', e);
                }
            }

            // ===== Ø¨Ù‚ÛŒÙ‡ ØªÙˆØ§Ø¨Ø¹ Ù…Ø«Ù„ Ù‚Ø¨Ù„ =====
            async function subscribeToSettings() {
                if (unsubscribeSettings) unsubscribeSettings();
                const { data, error } = await supabase
                    .from('settings')
                    .select('*')
                    .eq('id', 'general')
                    .single();
                if (data) {
                    bellSoundUrl = data.bellSoundUrl || bellSoundUrl;
                }
                if (isLoggedIn) {
                    document.getElementById('bellSoundUrl').value = bellSoundUrl;
                }
            }

            window.saveBellSound = async function() {
                const newUrl = document.getElementById('bellSoundUrl').value.trim();
                if (!newUrl) { alert('Ù„Ø·ÙØ§Ù‹ Ù„ÛŒÙ†Ú© Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return; }
                try {
                    const { error } = await supabase
                        .from('settings')
                        .upsert({ id: 'general', bellSoundUrl: newUrl });
                    if (error) throw error;
                    alert('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø²Ù†Ú¯ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                    bellSoundUrl = newUrl;
                } catch (error) {
                    alert('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡: ' + error.message);
                }
            };

            window.playTestBell = function() {
                const testUrl = document.getElementById('bellSoundUrl').value.trim() || bellSoundUrl;
                const audio = new Audio(testUrl);
                audio.play().catch(e => {
                    alert('Ù¾Ø®Ø´ ØµØ¯Ø§ Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªØ³Øª Ú©Ù†ÛŒØ¯.\nØ®Ø·Ø§: ' + e.message);
                });
            };

            window.login = async function() {
                const email = document.getElementById('email').value;
                const pass = document.getElementById('password').value;
                try {
                    const { data, error } = await supabase.auth.signInWithPassword({ email, password: pass });
                    if (error) throw error;
                    isLoggedIn = true;
                    updateLoginUI();
                    requestNotificationPermission();
                    await loadCoursesWithCache();
                } catch (error) {
                    alert('Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯: ' + error.message);
                }
            };

            window.logout = async function() {
                await supabase.auth.signOut();
                isLoggedIn = false;
                updateLoginUI();
                cancelEdit();
                await loadCoursesWithCache();
            };

            async function checkAuthState() {
                const { data: { user } } = await supabase.auth.getUser();
                isLoggedIn = !!user;
                updateLoginUI();
            }

            supabase.auth.onAuthStateChange((event, session) => {
                isLoggedIn = !!session?.user;
                updateLoginUI();
                if (event === 'SIGNED_IN' || event === 'SIGNED_OUT') {
                    loadCoursesWithCache();
                }
            });

            function updateLoginUI() {
                const emailInput = document.getElementById('email');
                const passwordInput = document.getElementById('password');
                const loginBtn = document.querySelector('#loginContainer button[onclick="login()"]');
                const logoutBtn = document.getElementById('logoutBtn');
                const adminSection = document.getElementById('adminSection');

                if (isLoggedIn) {
                    emailInput.style.display = 'none';
                    passwordInput.style.display = 'none';
                    loginBtn.style.display = 'none';
                    logoutBtn.style.display = 'inline-block';
                    adminSection.classList.add('visible');
                    document.getElementById('bellSoundUrl').value = bellSoundUrl;
                } else {
                    emailInput.style.display = 'inline-block';
                    passwordInput.style.display = 'inline-block';
                    loginBtn.style.display = 'inline-flex';
                    logoutBtn.style.display = 'none';
                    adminSection.classList.remove('visible');
                }
            }

            // ===== ØªÙˆØ§Ø¨Ø¹ Ù‚Ø¨Ù„ÛŒ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) =====
            function resetBellPlayed() { bellPlayed = new Array(coursesData.length).fill(false); }
            function timeToMinutes(t) { if (!t) return 0; let p = t.split(':'); return parseInt(p[0])*60 + parseInt(p[1]); }
            function getDayName(d) { return ['Ø´Ù†Ø¨Ù‡','ÛŒÚ©â€ŒØ´Ù†Ø¨Ù‡','Ø¯ÙˆØ´Ù†Ø¨Ù‡','Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡','Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡','Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡','Ø¬Ù…Ø¹Ù‡'][d]; }

            function sortCoursesWithPinned(tehranNow, currentDay, currentMinutes) {
                return [...coursesData].sort((a, b) => {
                    const aPinned = isPinned(a, currentDay, currentMinutes);
                    const bPinned = isPinned(b, currentDay, currentMinutes);
                    if (aPinned && !bPinned) return -1;
                    if (!aPinned && bPinned) return 1;
                    if (a.dayIndex !== b.dayIndex) return (a.dayIndex || 0) - (b.dayIndex || 0);
                    return timeToMinutes(a.startTime) - timeToMinutes(b.startTime);
                });
            }

            function isPinned(course, currentDay, currentMinutes) {
                if (course.dayIndex !== currentDay) return false;
                const end = timeToMinutes(course.endTime);
                return currentMinutes < end;
            }

            function renderCards() {
                const nowUTC = Date.now();
                const tehranNow = nowUTC + TEHRAN_OFFSET;
                const tehranDate = new Date(tehranNow);
                const jsDay = tehranDate.getUTCDay();
                const currentDay = (jsDay + 1) % 7;
                const currentHour = tehranDate.getUTCHours();
                const currentMin = tehranDate.getUTCMinutes();
                const currentMinutes = currentHour * 60 + currentMin;

                const sorted = sortCoursesWithPinned(tehranNow, currentDay, currentMinutes);

                const grid = document.getElementById('cardGrid');
                grid.innerHTML = '';
                if (sorted.length === 0) {
                    grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px; background:#fff9e6; border-radius:60px; border:2px dashed #d4af37;">Ù‡ÛŒÚ† Ø¯Ø±Ø³ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯. Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø±Ø³ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.</div>';
                    return;
                }
                sorted.forEach((course) => {
                    const startH = parseInt(course.startTime?.split(':')[0] || 0);
                    const startM = parseInt(course.startTime?.split(':')[1] || 0);
                    const card = document.createElement('div');
                    card.className = 'course-card';
                    card.setAttribute('data-id', course.id);
                    card.setAttribute('data-day', course.dayIndex);
                    card.setAttribute('data-start-hour', startH);
                    card.setAttribute('data-start-min', startM);
                    card.setAttribute('onclick', 'toggleCard(this)');

                    let adminDiv = '';
                    if (isLoggedIn) {
                        adminDiv = `
                            <div class="admin-controls">
                                <div class="edit-btn" onclick="event.stopPropagation(); editCourse('${course.id}')"><i class="fas fa-edit"></i></div>
                                <div class="delete-btn" onclick="event.stopPropagation(); deleteCourse('${course.id}')"><i class="fas fa-trash"></i></div>
                            </div>
                        `;
                    }

                    let onlineBadge = '', onlineLink = '';
                    if (course.isOnline) {
                        onlineBadge = '<div class="online-badge"><i class="fas fa-wifi"></i> Ø¢Ù†Ù„Ø§ÛŒÙ†</div>';
                        if (course.onlineLink) {
                            onlineLink = `<div class="online-link"><a href="${course.onlineLink}" target="_blank"><i class="fas fa-external-link-alt"></i> Ù„ÛŒÙ†Ú© Ø¬Ù„Ø³Ù‡</a></div>`;
                        }
                    }

                    const summary = document.createElement('div');
                    summary.className = 'card-summary';
                    summary.innerHTML = `
                        ${adminDiv}
                        <div class="day-time-badge"><i class="fas fa-calendar-day"></i> ${getDayName(course.dayIndex)} ${course.startTime}-${course.endTime}</div>
                        <span class="summary-course-name">${course.name}</span>
                        ${onlineBadge}
                        ${onlineLink}
                        <div class="countdown-area" id="countdown-${course.id}"><i class="fas fa-hourglass-half"></i><span>Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡...</span></div>
                        <div class="expand-icon"><i class="fas fa-chevron-down"></i></div>
                    `;

                    const details = document.createElement('div');
                    details.className = 'card-details';
                    details.innerHTML = `
                        <div class="details-content">
                            <div class="course-code"><i class="fas fa-hashtag"></i> ${course.code}</div>
                            <div class="units-mini">
                                <span><i class="fas fa-chalkboard"></i> ØªØ¦ÙˆØ±ÛŒ ${(course.theoretical||0).toFixed(1)}</span>
                                <span><i class="fas fa-flask"></i> Ø¹Ù…Ù„ÛŒ ${(course.practical||0).toFixed(1)}</span>
                                <span><i class="fas fa-layer-group"></i> Ú©Ù„ ${(course.total||0).toFixed(1)}</span>
                            </div>
                            <div class="info-row"><i class="fas fa-users-between-lines"></i> <span><strong>Ú¯Ø±ÙˆÙ‡ ${course.group_name || '---'}</strong> - Ø§Ø³ØªØ§Ø¯: ${course.professor}</span></div>
                            <div class="info-row"><i class="fas fa-building-columns"></i> <span>${course.location}</span></div>
                            ${course.isOnline && course.onlineLink ? `<div class="info-row"><i class="fas fa-link"></i> <span><a href="${course.onlineLink}" target="_blank">Ù„ÛŒÙ†Ú© Ø¬Ù„Ø³Ù‡</a></span></div>` : ''}
                            <div class="exam-simple">
                                <div class="exam-header"><i class="fas fa-pencil-alt"></i> Ø¢Ø²Ù…ÙˆÙ†</div>
                                <div class="exam-detail-item"><i class="fas fa-calendar-alt"></i> <span>${course.examDate||'Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡'} ${course.examTime?'<span class="exam-date-badge">'+course.examTime+'</span>':''}</span></div>
                                <div class="exam-detail-item"><i class="fas fa-hourglass-half"></i> Ù…Ø¯Øª: ${course.examDuration||'Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡'}</div>
                                <div class="exam-detail-item"><i class="fas fa-map-pin"></i> Ù…Ø­Ù„: ${course.examLocation||'Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡'}</div>
                            </div>
                        </div>
                    `;

                    const footer = document.createElement('div'); footer.className = 'card-footer';
                    card.appendChild(summary); card.appendChild(details); card.appendChild(footer);
                    grid.appendChild(card);
                });
            }

            function updateCountdownsAndBell() {
                // Ù‡Ù…Ø§Ù† ØªØ§Ø¨Ø¹ Ù‚Ø¨Ù„ÛŒ
                const nowUTC = Date.now();
                const tehranNow = nowUTC + TEHRAN_OFFSET;
                const tehranDate = new Date(tehranNow);
                const jsDay = tehranDate.getUTCDay();
                const currentDay = (jsDay + 1) % 7;
                const currentHour = tehranDate.getUTCHours();
                const currentMin = tehranDate.getUTCMinutes();
                const currentSec = tehranDate.getUTCSeconds();
                const currentMinutes = currentHour * 60 + currentMin;

                const persianFormatter = new Intl.DateTimeFormat('fa-IR', { timeZone: 'Asia/Tehran', dateStyle: 'full' });
                document.getElementById('dateDisplay').innerHTML = `<i class="fas fa-calendar-alt"></i> ${persianFormatter.format(new Date())}`;
                document.getElementById('timeDisplay').innerHTML = `<i class="fas fa-clock"></i> ${currentHour.toString().padStart(2,'0')}:${currentMin.toString().padStart(2,'0')}:${currentSec.toString().padStart(2,'0')}`;

                const cards = document.querySelectorAll('.course-card');
                let upcomingCount = 0;

                cards.forEach(card => {
                    const courseId = card.getAttribute('data-id');
                    const course = coursesData.find(c => c.id == courseId);
                    if (!course) return;

                    const cardDay = course.dayIndex;
                    const startHour = parseInt(card.getAttribute('data-start-hour'));
                    const startMin = parseInt(card.getAttribute('data-start-min'));
                    const endHour = parseInt(course.endTime?.split(':')[0] || 0);
                    const endMin = parseInt(course.endTime?.split(':')[1] || 0);
                    const startTotal = startHour*60 + startMin;
                    const endTotal = endHour*60 + endMin;

                    card.classList.remove('today-highlight');
                    if (cardDay === currentDay && currentMinutes < endTotal) {
                        card.classList.add('today-highlight');
                        upcomingCount++;
                    }

                    let diffDays = (cardDay - currentDay + 7) % 7;
                    if (diffDays === 0 && currentMinutes >= startTotal) diffDays = 7;

                    const targetTehran = tehranNow + diffDays * 86400000;
                    const targetDate = new Date(targetTehran);
                    targetDate.setUTCHours(0,0,0,0);
                    const targetStartDay = targetDate.getTime();
                    const targetWithHour = targetStartDay + startHour*3600000 + startMin*60000;
                    const targetUTC = targetWithHour - TEHRAN_OFFSET;
                    let diffMs = targetUTC - nowUTC;
                    if (diffMs < 0) diffMs = 0;

                    let displayText = '';
                    const isNowOngoing = (cardDay === currentDay && currentMinutes >= startTotal && currentMinutes < endTotal);
                    if (isNowOngoing) {
                        displayText = 'âš¡ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ';
                    } else {
                        const totalSec = Math.floor(diffMs / 1000);
                        const days = Math.floor(totalSec / 86400);
                        const hours = Math.floor((totalSec % 86400) / 3600);
                        const mins = Math.floor((totalSec % 3600) / 60);
                        const secs = totalSec % 60;
                        if (days > 0) displayText = `â³ ØªØ§ Ø´Ø±ÙˆØ¹: ${days} Ø±ÙˆØ² ${hours} Ø³Ø§Ø¹Øª`;
                        else if (hours > 0) displayText = `â³ ØªØ§ Ø´Ø±ÙˆØ¹: ${hours} Ø³Ø§Ø¹Øª ${mins} Ø¯Ù‚ÛŒÙ‚Ù‡`;
                        else if (mins > 0) displayText = `â³ ØªØ§ Ø´Ø±ÙˆØ¹: ${mins} Ø¯Ù‚ÛŒÙ‚Ù‡ ${secs} Ø«Ø§Ù†ÛŒÙ‡`;
                        else displayText = `â³ ØªØ§ Ø´Ø±ÙˆØ¹: ${secs} Ø«Ø§Ù†ÛŒÙ‡`;
                    }

                    const countSpan = card.querySelector('.countdown-area span');
                    if (countSpan) countSpan.innerText = displayText;

                    const index = coursesData.findIndex(c => c.id == courseId);
                    if (index !== -1) {
                        if (isNowOngoing && !bellPlayed[index]) {
                            playBell();
                            bellPlayed[index] = true;
                        }
                        if (!isNowOngoing && bellPlayed[index]) {
                            bellPlayed[index] = false;
                        }
                    }
                });

                const notif = document.getElementById('notifText');
                if (upcomingCount === 0) notif.innerText = 'Ø§Ù…Ø±ÙˆØ² Ú©Ù„Ø§Ø³ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ Ù†ÛŒØ³Øª';
                else if (upcomingCount === 1) notif.innerText = 'âš ï¸ Û± Ú©Ù„Ø§Ø³ Ø§Ù…Ø±ÙˆØ² Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡';
                else notif.innerText = `âš ï¸ ${upcomingCount} Ú©Ù„Ø§Ø³ Ø§Ù…Ø±ÙˆØ² Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡`;
            }

            function playBell() {
                if (bellSound) {
                    bellSound.src = bellSoundUrl;
                    bellSound.currentTime = 0;
                    bellSound.play().catch(e => {
                        console.log('Ù¾Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± ØµØ¯Ø§ Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª', e);
                        if (!window.soundWarningShown) {
                            window.soundWarningShown = true;
                            alert('Ø¨Ø±Ø§ÛŒ Ø´Ù†ÛŒØ¯Ù† ØµØ¯Ø§ÛŒ Ø²Ù†Ú¯ Ú©Ù„Ø§Ø³ØŒ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "ØªØ³Øª Ø²Ù†Ú¯" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.');
                        }
                    });
                }
            }

            window.editCourse = function(id) {
                const course = coursesData.find(c => c.id == id);
                if (!course) return;
                document.getElementById('editId').value = id;
                document.getElementById('courseName').value = course.name || '';
                document.getElementById('courseCode').value = course.code || '';
                document.getElementById('courseDay').value = course.dayIndex || 0;
                document.getElementById('startTime').value = course.startTime || '08:00';
                document.getElementById('endTime').value = course.endTime || '10:00';
                document.getElementById('professor').value = course.professor || '';
                document.getElementById('location').value = course.location || '';
                document.getElementById('courseGroup').value = course.group_name || '---';
                document.getElementById('theoretical').value = course.theoretical || 0;
                document.getElementById('practical').value = course.practical || 0;
                document.getElementById('total').value = course.total || 0;
                document.getElementById('isOnline').checked = course.isOnline || false;
                document.getElementById('onlineLink').value = course.onlineLink || '';
                document.getElementById('onlineLinkGroup').style.display = course.isOnline ? 'block' : 'none';
                document.getElementById('formTitle').innerText = 'ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø±Ø³';
                document.getElementById('adminSection').classList.add('visible');
            };

            window.deleteCourse = async function(id) {
                if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¯Ø±Ø³ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                    try {
                        await supabase.from('courses').delete().eq('id', id);
                        await loadCoursesWithCache();
                    } catch (error) {
                        alert('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù: ' + error.message);
                    }
                }
            };

            window.saveCourse = async function() {
                const name = document.getElementById('courseName').value.trim();
                const code = document.getElementById('courseCode').value.trim() || '---';
                const dayIndex = parseInt(document.getElementById('courseDay').value);
                const startTime = document.getElementById('startTime').value;
                const endTime = document.getElementById('endTime').value;
                const professor = document.getElementById('professor').value.trim() || 'Ù†Ø§Ù…Ø´Ø®Øµ';
                const location = document.getElementById('location').value.trim() || 'Ù†Ø§Ù…Ø´Ø®Øµ';
                const courseGroup = document.getElementById('courseGroup').value.trim() || '---';
                const theoretical = parseFloat(document.getElementById('theoretical').value) || 0;
                const practical = parseFloat(document.getElementById('practical').value) || 0;
                const total = parseFloat(document.getElementById('total').value) || 0;
                const isOnline = document.getElementById('isOnline').checked;
                const onlineLink = document.getElementById('onlineLink').value.trim();

                if (!name || !startTime || !endTime) { alert('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø±Ø³ Ùˆ Ø³Ø§Ø¹Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return; }

                const courseData = {
                    name, code, dayIndex, startTime, endTime,
                    theoretical, practical, total,
                    group_name: courseGroup, professor, location,
                    examDate: 'Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡', examTime: '', examDuration: 'Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡', examLocation: 'Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡',
                    isOnline, onlineLink
                };

                const editId = document.getElementById('editId').value;
                try {
                    if (editId) {
                        await supabase.from('courses').update(courseData).eq('id', editId);
                    } else {
                        await supabase.from('courses').insert([courseData]);
                    }
                    cancelEdit();
                    await loadCoursesWithCache();
                } catch (error) {
                    alert('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡: ' + error.message);
                }
            };

            window.cancelEdit = function() {
                document.getElementById('editId').value = '';
                document.getElementById('courseName').value = '';
                document.getElementById('courseCode').value = '';
                document.getElementById('startTime').value = '08:00';
                document.getElementById('endTime').value = '10:00';
                document.getElementById('professor').value = '';
                document.getElementById('location').value = '';
                document.getElementById('courseGroup').value = '---';
                document.getElementById('theoretical').value = '0.0';
                document.getElementById('practical').value = '0.0';
                document.getElementById('total').value = '0.0';
                document.getElementById('isOnline').checked = false;
                document.getElementById('onlineLink').value = '';
                document.getElementById('onlineLinkGroup').style.display = 'none';
                document.getElementById('formTitle').innerText = 'Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯';
            };

            document.getElementById('isOnline').addEventListener('change', function(e) {
                document.getElementById('onlineLinkGroup').style.display = e.target.checked ? 'block' : 'none';
            });

            window.toggleCard = function(card) { card.classList.toggle('expanded'); };

            // Ø´Ø±ÙˆØ¹ Ø¨Ù‡ Ú©Ø§Ø±
            checkAuthState().then(() => {
                subscribeToSettings();
                loadCoursesWithCache();
                setInterval(updateCountdownsAndBell, 1000);
            });
        })();
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(reg => {
                    console.log('Service Worker registered', reg);
                });
            });
        }

        // Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù… Ø§Ø² Ø³Ø±ÙˆÛŒØ³ ÙˆØ±Ú©Ø± Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙ
        navigator.serviceWorker?.addEventListener('message', event => {
            if (event.data.type === 'SHOW_NOTIFICATION') {
                new Notification(event.data.title, {
                    body: event.data.body,
                    icon: '/icons/icon-192x192.png'
                });
            }
        });
    </script>
</body>
</html>
