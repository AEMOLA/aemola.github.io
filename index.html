<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>ÿ®ÿ±ŸÜÿßŸÖŸá ⁄©ŸÑÿßÿ≥€å ŸáŸàÿ¥ŸÖŸÜÿØ | PWA</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@latest/dist/font-face.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/lenis@1.3.11/dist/lenis.css">
    <style>
        :root {
            --color-bg-dark: #141414;
            --color-surface: #1a1a1a;
            --color-surface-light: #252525;
            --color-gold: #d4af37;
            --color-gold-light: #f0e68c;
            --color-gold-dark: #b8860b;
            --color-gold-press: #8b691f;
            --color-text: #1e1e1e;
            --color-text-muted: #4a4a4a;
            --color-white-soft: rgba(255, 255, 255, 0.92);
            --color-card-bg: rgba(255, 255, 255, 0.88);
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 28px;
            --radius-xl: 36px;
            --radius-full: 9999px;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 8px 24px -4px rgba(0, 0, 0, 0.12), 0 4px 8px -2px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 20px 40px -10px rgba(0, 0, 0, 0.18), 0 8px 16px -4px rgba(0, 0, 0, 0.08);
            --shadow-gold: 0 4px 0 var(--color-gold-press);
            --transition-fast: 0.2s ease;
            --transition-smooth: 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        /* ÿ™ŸÖ ÿ±Ÿàÿ≤ ‚Äî Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ (ÿ™ÿßÿ®ÿ≥ÿ™ÿßŸÜ‚ÄåŸàÿßÿ±) */
        body.theme-day {
            --color-bg-dark: #1a1a0a;
            --color-surface: #2d2a1a;
            --color-surface-light: #3d3825;
            --color-gold: #c9a227;
            --color-gold-light: #e8d48a;
            --color-gold-dark: #9a7b1a;
            --color-gold-press: #6b5512;
            --color-text: #1e1e1e;
            --color-text-muted: #4a4a4a;
            --color-white-soft: rgba(255, 255, 255, 0.94);
            --color-card-bg: rgba(255, 252, 245, 0.92);
        }
        /* ÿ±Ÿàÿ≤ + ÿ®Ÿáÿßÿ± */
        body.theme-day.season-spring {
            --color-surface: #1e2e1c;
            --color-surface-light: #2d3d2a;
            --color-gold: #2e7d32;
            --color-gold-light: #66bb6a;
            --color-gold-dark: #1b5e20;
            --color-gold-press: #0d3d12;
            --color-card-bg: rgba(232, 245, 233, 0.92);
        }
        /* ÿ±Ÿàÿ≤ + ÿ™ÿßÿ®ÿ≥ÿ™ÿßŸÜ */
        body.theme-day.season-summer {
            --color-gold: #e65100;
            --color-gold-light: #ff9800;
            --color-gold-dark: #bf360c;
            --color-gold-press: #8d2c0a;
            --color-card-bg: rgba(255, 243, 224, 0.92);
        }
        /* ÿ±Ÿàÿ≤ + Ÿæÿß€å€åÿ≤ */
        body.theme-day.season-autumn {
            --color-surface: #2e2318;
            --color-surface-light: #3d3020;
            --color-gold: #d84315;
            --color-gold-light: #ff8a65;
            --color-gold-dark: #bf360c;
            --color-gold-press: #8d2c0a;
            --color-card-bg: rgba(255, 235, 220, 0.92);
        }
        /* ÿ±Ÿàÿ≤ + ÿ≤ŸÖÿ≥ÿ™ÿßŸÜ */
        body.theme-day.season-winter {
            --color-surface: #1a1e2e;
            --color-surface-light: #252d3d;
            --color-gold: #1565c0;
            --color-gold-light: #42a5f5;
            --color-gold-dark: #0d47a1;
            --color-gold-press: #0a3570;
            --color-card-bg: rgba(227, 242, 253, 0.92);
        }
        /* ÿ™ŸÖ ÿ¥ÿ® ‚Äî Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ */
        body.theme-night {
            --color-bg-dark: #0a0a14;
            --color-surface: #16162a;
            --color-surface-light: #22223d;
            --color-gold: #b8a030;
            --color-gold-light: #d4c860;
            --color-gold-dark: #7a6918;
            --color-gold-press: #4a3d0e;
            --color-text: #e8e8e8;
            --color-text-muted: #a0a0b0;
            --color-white-soft: rgba(255, 255, 255, 0.92);
            --color-card-bg: rgba(28, 28, 45, 0.88);
        }
        /* ÿ¥ÿ® + ÿ®Ÿáÿßÿ± */
        body.theme-night.season-spring {
            --color-gold: #4caf50;
            --color-gold-light: #81c784;
            --color-gold-dark: #2e7d32;
            --color-gold-press: #1b5e20;
        }
        /* ÿ¥ÿ® + ÿ™ÿßÿ®ÿ≥ÿ™ÿßŸÜ */
        body.theme-night.season-summer {
            --color-gold: #ff9800;
            --color-gold-light: #ffb74d;
            --color-gold-dark: #f57c00;
            --color-gold-press: #e65100;
        }
        /* ÿ¥ÿ® + Ÿæÿß€å€åÿ≤ */
        body.theme-night.season-autumn {
            --color-gold: #ff7043;
            --color-gold-light: #ffab91;
            --color-gold-dark: #e64a19;
            --color-gold-press: #bf360c;
        }
        /* ÿ¥ÿ® + ÿ≤ŸÖÿ≥ÿ™ÿßŸÜ */
        body.theme-night.season-winter {
            --color-gold: #42a5f5;
            --color-gold-light: #64b5f6;
            --color-gold-dark: #1976d2;
            --color-gold-press: #0d47a1;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { overflow-x: hidden; scroll-behavior: smooth; }
        body {
            font-family: 'Vazir', 'Tahoma', sans-serif;
            color: var(--color-text);
            line-height: 1.6;
            letter-spacing: 0.01em;
            padding: clamp(12px, 3vw, 20px);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            transition: color 0.6s ease, background-color 0.6s ease;
            background: transparent;
        }
        .dynamic-wallpaper {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
            transition: background 1.8s ease, box-shadow 1.8s ease;
            transform-style: preserve-3d;
            perspective: 1000px;
        }
        .dynamic-wallpaper .sky {
            position: absolute;
            inset: 0;
            transition: background 2s ease;
        }
        .dynamic-wallpaper::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse 150% 80% at bottom, rgba(0,0,0,0.08) 0%, rgba(0,0,0,0.04) 40%, transparent 70%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 2.5s ease, background 2.5s ease;
        }
        body.theme-night .dynamic-wallpaper::after {
            opacity: 1;
            background: radial-gradient(ellipse 150% 80% at bottom, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.2) 40%, transparent 70%);
        }
        body.theme-day.season-summer .dynamic-wallpaper::after {
            opacity: 0.3;
            background: radial-gradient(ellipse 150% 80% at bottom, rgba(255,200,100,0.15) 0%, transparent 60%);
        }
        body.theme-day.season-autumn .dynamic-wallpaper::after {
            opacity: 0.25;
            background: radial-gradient(ellipse 150% 80% at bottom, rgba(200,150,100,0.12) 0%, transparent 60%);
        }
        body.theme-day .dynamic-wallpaper .sky {
            background: 
                radial-gradient(ellipse 120% 60% at top, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0.2) 30%, transparent 60%),
                radial-gradient(ellipse 80% 40% at 70% 30%, rgba(255,240,200,0.3) 0%, transparent 50%),
                linear-gradient(180deg, #87ceeb 0%, #a8d8f0 20%, #b8e0f0 35%, #d0e8f5 50%, #e8f4f8 65%, #f5e6c8 80%, #e8d4a0 90%, #d4af37 100%);
        }
        body.theme-day.season-spring .dynamic-wallpaper .sky {
            background: 
                radial-gradient(ellipse at top, rgba(255,255,255,0.5) 0%, transparent 50%),
                linear-gradient(180deg, #a8d5e8 0%, #b8e0f0 25%, #d0e8f5 45%, #e8f4f8 60%, #f0f8e8 75%, #e8f5d0 85%, #c8e8a0 95%, #a8d080 100%);
        }
        body.theme-day.season-summer .dynamic-wallpaper .sky {
            background: 
                radial-gradient(ellipse at top, rgba(255,240,200,0.6) 0%, transparent 50%),
                linear-gradient(180deg, #87ceeb 0%, #a8d8f0 20%, #ffd8a0 40%, #ffc880 60%, #ffb860 75%, #ffa840 85%, #ff9800 95%, #e65100 100%);
        }
        body.theme-day.season-autumn .dynamic-wallpaper .sky {
            background: 
                radial-gradient(ellipse at top, rgba(255,230,200,0.5) 0%, transparent 50%),
                linear-gradient(180deg, #a8c8e8 0%, #c8a8a0 25%, #d8a880 45%, #e8a060 60%, #f0a050 75%, #ff8a40 85%, #ff7043 95%, #d84315 100%);
        }
        body.theme-day.season-winter .dynamic-wallpaper .sky {
            background: 
                radial-gradient(ellipse at top, rgba(240,248,255,0.6) 0%, transparent 50%),
                linear-gradient(180deg, #b0d0e8 0%, #c0d8f0 25%, #d0e0f8 45%, #e0e8f8 60%, #e8f0f8 75%, #f0f4f8 85%, #e8e8f0 95%, #c0c8d8 100%);
        }
        body.theme-night .dynamic-wallpaper .sky {
            background: 
                radial-gradient(ellipse 100% 50% at 30% 20%, rgba(150,200,255,0.2) 0%, rgba(100,150,255,0.1) 40%, transparent 70%),
                radial-gradient(ellipse 60% 30% at 70% 25%, rgba(200,220,255,0.15) 0%, transparent 50%),
                linear-gradient(180deg, #0a0a1a 0%, #0f0f2a 15%, #1a1a3a 30%, #16213e 45%, #0f3460 60%, #1a1a2e 75%, #0a0a1a 100%);
        }
        body.theme-night.season-winter .dynamic-wallpaper .sky {
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(150,200,255,0.2) 0%, transparent 50%),
                linear-gradient(180deg, #0a0a1a 0%, #0f1528 20%, #1a2540 40%, #1e2e50 55%, #1a2e4a 70%, #0f1a2e 85%, #0a0a1a 100%);
        }
        body.theme-night.season-spring .dynamic-wallpaper .sky {
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(100,200,150,0.1) 0%, transparent 50%),
                linear-gradient(180deg, #0a0a1a 0%, #0f1a1a 20%, #1a2a2a 40%, #1e3a2e 55%, #1a2e2a 70%, #0f1a1a 85%, #0a0a1a 100%);
        }
        body.theme-night.season-summer .dynamic-wallpaper .sky {
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(255,180,100,0.12) 0%, transparent 50%),
                linear-gradient(180deg, #0a0a1a 0%, #1a0f0a 20%, #2a1a0f 40%, #3a2515 55%, #2a1a0f 70%, #1a0f0a 85%, #0a0a1a 100%);
        }
        body.theme-night.season-autumn .dynamic-wallpaper .sky {
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(255,150,100,0.1) 0%, transparent 50%),
                linear-gradient(180deg, #0a0a1a 0%, #1a0f0a 20%, #2a1a0f 40%, #3a2518 55%, #2a1a0f 70%, #1a0f0a 85%, #0a0a1a 100%);
        }
        /* ÿÆŸàÿ±ÿ¥€åÿØ Ÿà ŸÖÿßŸá ‚Äî ÿ™ÿµŸà€åÿ±ÿå ÿ®ÿßŸÑÿßÿ™ÿ± ÿßÿ≤ Ÿàÿ≥ÿ∑ ÿµŸÅÿ≠Ÿá */
        .dynamic-wallpaper .wp-bg-image {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            opacity: 0.9;
            z-index: -1;
            display: none;
        }
        .dynamic-wallpaper .wp-sun,
        .dynamic-wallpaper .wp-moon {
            position: absolute;
            width: clamp(52px, 8vw, 80px);
            height: auto;
            object-fit: contain;
            pointer-events: none;
            opacity: 0;
            transition: opacity 2s ease;
            transform-origin: center;
            z-index: 4;
        }
        .dynamic-wallpaper .wp-sun { right: 50%; top: 45%; transform: translate(-50%, -50%); }
        .dynamic-wallpaper .wp-moon { right: 50%; top: 45%; transform: translate(-50%, -50%); width: clamp(40px, 6vw, 58px); }
        body.theme-day .dynamic-wallpaper .wp-sun { opacity: 1; }
        body.theme-night .dynamic-wallpaper .wp-moon { opacity: 1; }
        .dynamic-wallpaper .clouds {
            position: absolute; inset: 0;
            opacity: 0;
            transition: opacity 2s ease;
            pointer-events: none;
            z-index: 5;
        }
        body.theme-day .dynamic-wallpaper .clouds { opacity: 1; }
        .dynamic-wallpaper .wp-cloud {
            position: absolute;
            width: clamp(80px, 18vw, 140px);
            height: auto;
            object-fit: contain;
            pointer-events: none;
            will-change: transform;
            animation: wp-cloud-drift 140s linear infinite;
        }
        .dynamic-wallpaper .wp-cloud-1 { top: 15%; right: 8%; animation-delay: 0s; }
        .dynamic-wallpaper .wp-cloud-2 { top: 32%; right: 45%; animation-delay: -50s; animation-duration: 160s; }
        .dynamic-wallpaper .wp-cloud-3 { top: 22%; right: 75%; animation-delay: -90s; animation-duration: 150s; }
        body.quality-high .dynamic-wallpaper .wp-cloud-3 { display: block; }
        .dynamic-wallpaper .wp-cloud-3 { display: none; }
        @keyframes wp-cloud-drift {
            0% { transform: translateX(0); }
            100% { transform: translateX(-120vw); }
        }
        .dynamic-wallpaper .stars {
            position: absolute; inset: 0;
            opacity: 0;
            transition: opacity 2s ease;
        }
        body.theme-night .dynamic-wallpaper .stars { opacity: 1; }
        .dynamic-wallpaper .star {
            position: absolute;
            width: 2px; height: 2px;
            background: #fff;
            border-radius: 50%;
            animation: wp-twinkle 4s ease-in-out infinite;
            contain: strict;
        }
        .dynamic-wallpaper .star:nth-child(odd) { animation-delay: 0.8s; }
        .dynamic-wallpaper .star:nth-child(3n) { animation-delay: 1.6s; }
        @keyframes wp-twinkle {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }
        .dynamic-wallpaper .particles {
            position: absolute; inset: 0;
            overflow: hidden;
            pointer-events: none;
        }
        .dynamic-wallpaper .particle {
            position: absolute;
            contain: layout style;
            will-change: transform;
        }
        .dynamic-wallpaper .particle.leaf {
            width: 10px; height: 12px;
            background: linear-gradient(135deg, #8b4513, #cd853f);
            border-radius: 50% 0 50% 50%;
            animation: wp-fall-leaf var(--dur, 18s) linear infinite;
            animation-delay: var(--delay, 0s);
        }
        .dynamic-wallpaper .particle.leaf.spring {
            background: linear-gradient(135deg, #228b22, #90ee90);
        }
        .dynamic-wallpaper .particle.snowflake {
            width: 6px; height: 6px;
            background: radial-gradient(circle at 30% 30%, #fff, rgba(220,235,255,0.8));
            border-radius: 50%;
            animation: wp-fall-snow var(--dur, 20s) linear infinite;
            animation-delay: var(--delay, 0s);
        }
        .dynamic-wallpaper .particle.petal {
            width: 8px; height: 8px;
            background: radial-gradient(circle at 30% 30%, #ffb6c1, #ff69b4);
            border-radius: 50% 0 50% 50%;
            animation: wp-fall-petal var(--dur, 16s) linear infinite;
            animation-delay: var(--delay, 0s);
        }
        @keyframes wp-fall-leaf {
            0% { transform: translateY(-5%) translateX(0) rotate(var(--r, 0deg)); }
            100% { transform: translateY(105vh) translateX(35px) rotate(calc(var(--r, 0deg) + 720deg)); }
        }
        @keyframes wp-fall-snow {
            0% { transform: translateY(-5%) translateX(0) rotate(0deg); }
            100% { transform: translateY(105vh) translateX(25px) rotate(360deg); }
        }
        @keyframes wp-fall-petal {
            0% { transform: translateY(-5%) translateX(0) rotate(0deg); }
            100% { transform: translateY(105vh) translateX(-20px) rotate(400deg); }
        }
        /* ÿ≤ŸÖ€åŸÜ ‚Äî €å⁄©€å per ŸÅÿµŸÑ */
        .dynamic-wallpaper .wp-ground {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 30vh;
            object-fit: cover;
            object-position: bottom;
            z-index: 2;
            pointer-events: none;
            transition: opacity 2s ease;
        }
        .dynamic-wallpaper .wp-ground-spring,
        .dynamic-wallpaper .wp-ground-summer,
        .dynamic-wallpaper .wp-ground-autumn,
        .dynamic-wallpaper .wp-ground-snow { display: none; }
        body.season-spring .dynamic-wallpaper .wp-ground-spring { display: block; }
        body.season-summer .dynamic-wallpaper .wp-ground-summer { display: block; }
        body.season-autumn .dynamic-wallpaper .wp-ground-autumn { display: block; }
        body.season-winter .dynamic-wallpaper .wp-ground-snow { display: block; }
        /* ÿ¨ŸÑŸà⁄Ø€åÿ±€å ÿßÿ≤ ŸÖÿ¥⁄©ŸÑÿßÿ™ ÿ™ÿ±ŸÜÿ≥Ÿæÿ±ŸÜÿ™ ÿØÿ± ÿØÿ≥⁄©ÿ™ÿßŸæ: ÿ®Ÿá‚Äåÿ¨ÿß€å filter ŸÅŸÇÿ∑ opacity */
        body.theme-night .dynamic-wallpaper .wp-ground { opacity: 0.75; }
        body.theme-night.season-winter .dynamic-wallpaper .wp-ground { opacity: 0.85; }
        /* ÿØÿ±ÿÆÿ™ ‚Äî ⁄ÜŸÜÿØ ÿ¨ÿßÿå €å⁄©€å per ŸÅÿµŸÑ */
        .dynamic-wallpaper .wp-tree {
            position: absolute;
            bottom: 0;
            height: auto;
            max-height: 32vh;
            object-fit: contain;
            object-position: bottom;
            z-index: 3;
            pointer-events: none;
            transition: opacity 2s ease, filter 1.5s ease;
        }
        .dynamic-wallpaper .wp-tree-pos1 { right: 6%; width: clamp(65px, 11vw, 100px); }
        .dynamic-wallpaper .wp-tree-pos2 { right: 34%; width: clamp(50px, 8vw, 78px); }
        .dynamic-wallpaper .wp-tree-pos3 { left: 8%; width: clamp(58px, 10vw, 90px); }
        .dynamic-wallpaper .wp-tree-spring,
        .dynamic-wallpaper .wp-tree-summer,
        .dynamic-wallpaper .wp-tree-autumn,
        .dynamic-wallpaper .wp-tree-winter { display: none; }
        body.season-spring .dynamic-wallpaper .wp-tree-spring { display: block; }
        body.season-summer .dynamic-wallpaper .wp-tree-summer { display: block; }
        body.season-autumn .dynamic-wallpaper .wp-tree-autumn { display: block; }
        body.season-winter .dynamic-wallpaper .wp-tree-winter { display: block; }
        @media (max-width: 768px) {
            /* ÿØÿ± ŸÖŸàÿ®ÿß€åŸÑ: ÿßÿ®ÿ±Ÿáÿß ÿØÿ± ÿ≠ÿßŸÑÿ™ ÿ≥ÿ±€åÿπ ŸÖÿÆŸÅ€åÿå ÿØÿ± ÿ≠ÿßŸÑÿ™‚ÄåŸáÿß€å ÿ®ÿßŸÑÿßÿ™ÿ± ŸÅÿπÿßŸÑ */
            body.quality-fast .dynamic-wallpaper .clouds { display: none; }
            body.quality-medium .dynamic-wallpaper .clouds,
            body.quality-high .dynamic-wallpaper .clouds { display: block; }
            /* ÿØÿ± ŸÖŸàÿ®ÿß€åŸÑ: ÿØÿ± ÿ≠ÿßŸÑÿ™ ÿ≥ÿ±€åÿπ ÿ®ÿØŸàŸÜ ÿ∞ÿ±ÿßÿ™ÿå ÿØÿ± ÿ≠ÿßŸÑÿ™‚ÄåŸáÿß€å ÿ®ÿßŸÑÿßÿ™ÿ± ÿ∞ÿ±ÿßÿ™ ŸÅÿπÿßŸÑ ÿ®ÿßÿ¥ŸÜÿØ */
            body.quality-fast .dynamic-wallpaper .particles { display: none; }
            body.quality-medium .dynamic-wallpaper .particles,
            body.quality-high .dynamic-wallpaper .particles { display: block; }
            .dynamic-wallpaper .wp-tree-pos1 { right: 4%; width: clamp(48px, 16vw, 72px); }
            .dynamic-wallpaper .wp-tree-pos2 { right: 32%; width: clamp(40px, 12vw, 58px); }
            .dynamic-wallpaper .wp-tree-pos3 { left: 5%; width: clamp(44px, 14vw, 65px); }
            .dynamic-wallpaper .wp-ground { height: 26vh; }
        }
        @media (prefers-reduced-motion: reduce) {
            .dynamic-wallpaper .clouds { display: none; }
            .dynamic-wallpaper .star { animation: none; opacity: 0.8; }
            .dynamic-wallpaper .particle { animation: none; }
        }
        body.theme-night .header {
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.6), inset 0 1px 3px rgba(255,215,0,0.15);
        }
        body.theme-night .course-card {
            background: var(--color-card-bg);
            box-shadow: 0 15px 35px -8px rgba(0,0,0,0.35);
        }
        body.theme-night .instruction {
            background: var(--color-card-bg);
            color: var(--color-text);
        }
        body.theme-night .offline-banner {
            background: color-mix(in srgb, var(--color-gold) 20%, var(--color-card-bg));
            color: var(--color-text);
            border-color: var(--color-gold);
        }
        body.theme-night .datetime-panel {
            background: linear-gradient(145deg, var(--color-surface) 0%, var(--color-surface-light) 100%);
            border-color: var(--color-gold);
            box-shadow: 0 4px 0 var(--color-gold-press), var(--shadow-sm);
        }
        body.theme-night .date-box,
        body.theme-night .time-box {
            background: rgba(0, 0, 0, 0.25);
            color: var(--color-gold-light);
            border-color: var(--color-gold);
        }
        body.theme-night .notification-badge {
            background: linear-gradient(145deg, var(--color-gold), var(--color-gold-dark));
            color: var(--color-surface);
        }
        body.theme-night .login-simple {
            background: var(--color-surface);
            border-color: var(--color-gold);
        }
        body.theme-night .login-simple input {
            background: rgba(0, 0, 0, 0.3);
            border-color: var(--color-gold);
            color: var(--color-white-soft);
        }
        body.theme-night .instruction {
            background: var(--color-card-bg);
            color: var(--color-text);
            border-color: var(--color-gold);
        }
        body.theme-night .instruction i { color: var(--color-gold); }
        .container {
            max-width: 1320px;
            margin: 0 auto;
            width: 100%;
            flex: 1;
            position: relative;
            z-index: 1;
            background: transparent;
        }
        .header {
            position: relative;
            background: linear-gradient(145deg, var(--color-surface) 0%, var(--color-surface-light) 100%);
            color: var(--color-gold);
            padding: clamp(1.5rem, 4vw, 2.25rem) clamp(1rem, 3vw, 1.5rem);
            border-radius: var(--radius-xl);
            margin-bottom: clamp(20px, 4vw, 32px);
            box-shadow: var(--shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.08);
            border: 2px solid var(--color-gold);
            border-bottom-width: 4px;
            text-align: center;
            transition: background 0.6s ease, color 0.6s ease, border-color 0.6s ease, box-shadow 0.6s ease;
        }
        .header h1 {
            font-size: clamp(1.5rem, 4vw, 2.1rem);
            font-weight: 800;
            letter-spacing: -0.02em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .header h1 img {
            height: clamp(48px, 8vw, 60px);
            margin-left: 0.75rem;
            border-radius: 50%;
            background-color: var(--color-gold);
            padding: 4px;
            box-shadow: var(--shadow-sm);
        }
        .header h1 i { color: var(--color-gold-light); font-size: 1.5rem; opacity: 0.95; }
        .header p {
            font-size: 0.95rem;
            color: var(--color-gold-light);
            border-top: 2px dashed var(--color-gold);
            border-bottom: 2px dashed var(--color-gold);
            display: inline-block;
            padding: 0.45rem 1.25rem;
            background-color: rgba(0, 0, 0, 0.35);
            border-radius: var(--radius-full);
            margin-top: 0.5rem;
            opacity: 0.95;
        }
        .add-course-section h3,
        .sound-settings h4,
        .theme-preview-settings h4 { color: var(--color-text); }
        .top-panel {
            display: flex;
            flex-wrap: wrap;
            gap: clamp(12px, 2vw, 18px);
            margin-bottom: clamp(16px, 3vw, 24px);
            align-items: center;
            justify-content: space-between;
        }
        .datetime-panel {
            background: linear-gradient(145deg, #fffbf0 0%, #fff4dc 100%);
            border: 2px solid var(--color-gold);
            border-radius: var(--radius-full);
            padding: 0.7rem 1.25rem;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.75rem;
            box-shadow: 0 4px 0 var(--color-gold-press), var(--shadow-sm);
            flex: 2;
            min-width: min(100%, 280px);
            transition: background 0.6s ease, border-color 0.6s ease, box-shadow 0.6s ease;
        }
        .date-box, .time-box {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: clamp(0.95rem, 2vw, 1.1rem);
            font-weight: 700;
            background: var(--color-surface);
            color: var(--color-gold);
            padding: 0.5rem 1.15rem;
            border-radius: var(--radius-full);
            border: 2px solid var(--color-gold-light);
            transition: background 0.5s ease, color 0.5s ease, border-color 0.5s ease;
        }
        .date-box i, .time-box i { color: var(--color-gold-light); }
        .notification-badge {
            background: linear-gradient(145deg, var(--color-gold), var(--color-gold-dark));
            color: var(--color-surface);
            padding: 0.5rem 1.15rem;
            border-radius: var(--radius-full);
            font-weight: 800;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            box-shadow: 0 4px 0 var(--color-gold-press);
            transition: background 0.5s ease, color 0.5s ease, box-shadow 0.5s ease;
        }
        .login-simple {
            background: var(--color-surface);
            border: 2px solid var(--color-gold);
            border-radius: var(--radius-full);
            padding: 0.35rem 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-gold);
        }
        .login-simple input {
            background: #2d2d2d;
            border: 1px solid var(--color-gold);
            border-radius: var(--radius-full);
            padding: 0.4rem 0.85rem;
            color: #fff;
            width: 100px;
            font-family: 'Vazir', sans-serif;
            font-size: 0.85rem;
            transition: var(--transition-fast);
        }
        .login-simple input:focus {
            outline: none;
            border-color: var(--color-gold-light);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.25);
        }
        .login-simple input::placeholder { color: #888; }
        .login-simple button {
            background: var(--color-gold);
            color: var(--color-surface);
            border: none;
            border-radius: var(--radius-full);
            padding: 0.4rem 1rem;
            font-weight: 700;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.35rem;
            white-space: nowrap;
            transition: var(--transition-fast);
        }
        .login-simple button:hover { background: var(--color-gold-dark); color: #fff; }
        .login-simple button:focus-visible { outline: 2px solid var(--color-gold-light); outline-offset: 2px; }
        .login-simple .logout-btn {
            background: transparent;
            border: 2px solid var(--color-gold);
            color: var(--color-gold);
        }
        .login-simple .logout-btn:hover { background: rgba(212, 175, 55, 0.15); }
        .instruction {
            text-align: center;
            margin-bottom: clamp(18px, 3vw, 26px);
            color: var(--color-text);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 0.75rem 1.25rem;
            border-radius: var(--radius-full);
            border: 2px solid var(--color-gold);
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.6rem;
            flex-wrap: wrap;
            transition: background 0.5s ease, color 0.5s ease, border-color 0.5s ease;
        }
        .instruction i { color: var(--color-gold-dark); font-size: 1.2rem; animation: bounce 1.8s ease-in-out infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        .offline-banner {
            text-align: center;
            padding: 0.6rem 1rem;
            margin-bottom: 1rem;
            background: #fff8e1;
            color: #7d5a00;
            border: 2px solid var(--color-gold);
            border-radius: var(--radius-full);
            font-weight: 700;
            font-size: 0.9rem;
        }
        .offline-banner i { margin-left: 0.4rem; }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: clamp(20px, 3vw, 28px);
            justify-items: stretch;
        }
        @media (max-width: 700px) {
            .card-grid { grid-template-columns: 1fr; }
        }
        .course-card {
            background: var(--color-card-bg);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md), 0 0 0 1px var(--color-gold) inset;
            transition: transform var(--transition-smooth), box-shadow var(--transition-smooth), border-color 0.5s ease, background 0.5s ease, border-radius 0.5s ease;
            border: 2px solid var(--color-gold);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            user-select: none;
            height: fit-content;
            transform: translateZ(0);
            position: relative;
            width: 100%;
            min-width: 0;
        }
        .course-card::before {
            content: '';
            position: absolute;
            top: 0.6rem;
            right: 0.6rem;
            width: 28px;
            height: 28px;
            opacity: 0.35;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }
        body.theme-night .course-card::before {
            content: '‚òÖ';
            font-size: 1.4rem;
            color: var(--color-gold-light);
            background: none;
            line-height: 1;
        }
        body.theme-day .course-card::before {
            content: '‚úø';
            font-size: 1.35rem;
            color: var(--color-gold);
            background: none;
            line-height: 1;
        }
        body.theme-night.season-winter .course-card::before { content: '‚ùÑ'; }
        body.theme-day.season-spring .course-card::before { content: 'üå∏'; }
        body.theme-day.season-summer .course-card::before { content: '‚òÄ'; }
        body.theme-day.season-autumn .course-card::before { content: 'üçÇ'; }
        body.theme-night.season-spring .course-card::before { content: '‚úø'; }
        body.theme-night.season-summer .course-card::before { content: '‚òÜ'; }
        body.theme-night.season-autumn .course-card::before { content: '‚ú¶'; }
        .course-card:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow: var(--shadow-lg), 0 0 0 2px var(--color-gold) inset;
            border-color: var(--color-gold-light);
        }
        .course-card:hover::before { opacity: 0.6; }
        body.theme-night .course-card {
            border-radius: 18px 18px 22px 22px;
            box-shadow: var(--shadow-md), 0 0 20px rgba(255,215,0,0.08), 0 0 0 1px var(--color-gold) inset;
        }
        body.theme-day .course-card {
            border-radius: 28px 28px 24px 24px;
        }
        body.season-spring .course-card { border-radius: 32px 26px 26px 32px; }
        body.season-winter .course-card { border-radius: 22px 22px 18px 18px; }
        .course-card:focus-visible { outline: 2px solid var(--color-gold); outline-offset: 3px; }
        .admin-controls {
            position: absolute;
            top: 0.6rem;
            left: 0.6rem;
            display: flex;
            gap: 0.5rem;
            z-index: 10;
        }
        .edit-btn, .delete-btn {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition-fast);
            border: 2px solid var(--color-gold);
        }
        .edit-btn { background: var(--color-gold); color: var(--color-surface); }
        .delete-btn { background: rgba(0, 0, 0, 0.65); color: #e74c3c; }
        .edit-btn:hover { background: var(--color-gold-dark); color: #fff; transform: scale(1.05); }
        .delete-btn:hover { background: #e74c3c; color: #fff; border-color: #c0392b; transform: scale(1.05); }
        .edit-btn:focus-visible, .delete-btn:focus-visible { outline: 2px solid var(--color-gold-light); outline-offset: 2px; }
        .online-badge {
            background: linear-gradient(145deg, #27ae60, #219a52);
            color: #fff;
            padding: 0.25rem 0.9rem;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 700;
            margin-top: 0.5rem;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            box-shadow: 0 2px 6px rgba(39, 174, 96, 0.35);
        }
        .online-link { margin-top: 0.5rem; font-size: 0.88rem; }
        .online-link a {
            color: #1e8449;
            text-decoration: none;
            background: rgba(39, 174, 96, 0.12);
            padding: 0.25rem 0.9rem;
            border-radius: var(--radius-full);
            border: 1px solid #27ae60;
            transition: var(--transition-fast);
        }
        .online-link a:hover { background: rgba(39, 174, 96, 0.25); }
        .course-card.today-highlight {
            box-shadow: 0 0 0 3px rgba(241, 196, 15, 0.5), var(--shadow-lg), 0 0 0 1px var(--color-gold-dark) inset;
            background: color-mix(in srgb, var(--color-gold-light) 25%, var(--color-card-bg));
            backdrop-filter: blur(14px);
            border-color: var(--color-gold);
            transform: scale(1.01);
        }
        .course-card.today-highlight .day-time-badge {
            background: linear-gradient(145deg, var(--color-gold), var(--color-gold-dark));
            color: var(--color-surface);
            border-color: rgba(255, 255, 255, 0.4);
        }
        .course-card.today-highlight .day-time-badge i { color: var(--color-surface); }
        .course-card.today-highlight .summary-course-name {
            background: linear-gradient(145deg, var(--color-gold-light), var(--color-gold));
            border-color: var(--color-gold-dark);
            color: var(--color-text);
        }
        .card-summary {
            padding: clamp(1.4rem, 3vw, 1.8rem) 1rem clamp(1rem, 2vw, 1.2rem);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            background: transparent;
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        }
        .day-time-badge {
            background: linear-gradient(145deg, var(--color-surface), var(--color-surface-light));
            color: var(--color-gold);
            padding: 0.65rem 1.1rem;
            border-radius: var(--radius-full);
            font-weight: 800;
            font-size: clamp(1rem, 2vw, 1.15rem);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.9rem;
            border: 2px solid var(--color-gold);
            width: 100%;
            justify-content: center;
            box-shadow: 0 4px 0 var(--color-gold-press);
            transition: background 0.5s ease, color 0.5s ease, border-color 0.5s ease;
        }
        .day-time-badge i { color: var(--color-gold-light); font-size: 1.15rem; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3)); }
        .summary-course-name {
            font-size: clamp(1.2rem, 2.5vw, 1.45rem);
            font-weight: 800;
            color: var(--color-text);
            background: linear-gradient(145deg, var(--color-gold-light), var(--color-gold));
            padding: 0.5rem 1.25rem;
            border-radius: var(--radius-full);
            display: inline-block;
            border: 2px solid var(--color-gold-dark);
            word-break: break-word;
            max-width: 100%;
            box-shadow: 0 3px 0 var(--color-gold-press);
            line-height: 1.4;
            transition: background 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
        }
        .countdown-area {
            margin-top: 0.75rem;
            width: 100%;
            font-size: 0.88rem;
            font-weight: 600;
            background: color-mix(in srgb, var(--color-gold) 15%, transparent);
            padding: 0.45rem 0.85rem;
            border-radius: var(--radius-full);
            border: 1px solid var(--color-gold);
            color: var(--color-text);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            backdrop-filter: blur(4px);
            transition: background 0.5s ease, border-color 0.5s ease;
        }
        .expand-icon {
            margin-top: 0.9rem;
            color: var(--color-gold-dark);
            font-size: 1.2rem;
            transition: transform var(--transition-smooth), background 0.5s ease, color 0.5s ease;
            background: color-mix(in srgb, var(--color-gold) 15%, transparent);
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .course-card.expanded .expand-icon i { transform: rotate(180deg); }
        .card-details {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.45s ease-in-out, opacity 0.35s ease-in-out, padding 0.35s;
            background: transparent;
            border-radius: 0 0 var(--radius-xl) var(--radius-xl);
            border-top: 0 solid var(--color-gold);
        }
        .course-card.expanded .card-details {
            max-height: 900px;
            opacity: 1;
            padding: 1.1rem 1.1rem 1.6rem;
            border-top-width: 3px;
        }
        .details-content { color: var(--color-text); }
        .course-code {
            background: var(--color-surface);
            color: var(--color-gold);
            padding: 0.4rem 1rem;
            border-radius: var(--radius-full);
            font-size: 0.88rem;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            margin-bottom: 0.9rem;
            border: 1px solid var(--color-gold);
        }
        .units-mini {
            display: flex;
            gap: 0.75rem;
            background: color-mix(in srgb, var(--color-gold) 12%, transparent);
            padding: 0.55rem 1.1rem;
            border-radius: var(--radius-full);
            width: fit-content;
            margin-bottom: 0.9rem;
            border: 2px solid var(--color-gold);
            font-size: 0.9rem;
            flex-wrap: wrap;
            transition: background 0.5s ease;
        }
        .units-mini span { display: flex; align-items: center; gap: 0.4rem; color: var(--color-text); }
        .units-mini i { color: var(--color-gold-dark); }
        .info-row {
            display: flex;
            align-items: center;
            gap: 0.65rem;
            margin-bottom: 0.65rem;
            font-size: 0.9rem;
            background: color-mix(in srgb, var(--color-gold) 8%, transparent);
            backdrop-filter: blur(4px);
            padding: 0.65rem 1rem;
            border-radius: var(--radius-full);
            border-right: 4px solid var(--color-gold);
            color: var(--color-text);
            transition: background 0.5s ease, color 0.5s ease;
        }
        .info-row i { width: 22px; color: var(--color-gold-dark); font-size: 1rem; flex-shrink: 0; }
        .exam-simple {
            margin-top: 0.9rem;
            background: linear-gradient(145deg, var(--color-surface), var(--color-surface-light));
            color: var(--color-text);
            padding: 0.9rem 1.1rem;
            border-radius: var(--radius-lg);
            border: 2px solid var(--color-gold);
            box-shadow: var(--shadow-gold);
        }
        .exam-simple .exam-header {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: var(--color-gold);
            font-weight: 800;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        .exam-detail-item {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            margin-right: 0.35rem;
            margin-bottom: 0.4rem;
            font-size: 0.9rem;
            color: var(--color-text);
        }
        .exam-detail-item i { width: 18px; color: var(--color-gold); flex-shrink: 0; }
        .exam-date-badge {
            background: var(--color-gold);
            color: var(--color-surface);
            padding: 0.2rem 0.75rem;
            border-radius: var(--radius-full);
            font-weight: 800;
            font-size: 0.75rem;
            display: inline-block;
            margin-left: 0.4rem;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .card-footer {
            display: none;
        }
        body.theme-night .course-card.expanded .card-details { border-radius: 0 0 22px 22px; }
        body.theme-day .course-card.expanded .card-details { border-radius: 0 0 24px 24px; }
        body.season-spring .course-card.expanded .card-details { border-radius: 0 0 26px 32px; }
        body.season-winter .course-card.expanded .card-details { border-radius: 0 0 18px 18px; }
        .add-course-section {
            margin: 40px 0 20px;
            background: linear-gradient(145deg, color-mix(in srgb, var(--color-gold-light) 18%, #fff), color-mix(in srgb, var(--color-gold) 22%, #fff));
            border: 3px solid var(--color-gold);
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            box-shadow: 0 8px 0 var(--color-gold-press);
            display: none;
            transition: background 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
        }
        .add-course-section.visible { display: block; }
        .add-course-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .form-group label {
            font-weight: 700;
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.9rem;
        }
        .form-group input, .form-group select, .form-group textarea {
            padding: 0.5rem 0.9rem;
            border-radius: var(--radius-full);
            border: 2px solid var(--color-gold);
            background: var(--color-card-bg);
            color: var(--color-text);
            font-family: 'Vazir', sans-serif;
            font-size: 0.9rem;
            transition: border-color 0.3s ease, background 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--color-gold-light);
        }
        .checkbox-group {
            flex-direction: row;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-add, .btn-cancel, .btn-save-sound, .btn-test-notif {
            padding: 0.5rem 1.1rem;
            border-radius: var(--radius-full);
            font-weight: 700;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background 0.25s ease, color 0.25s ease, border-color 0.25s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            height: fit-content;
            border: 2px solid var(--color-gold);
            min-height: 2.5rem;
        }
        .btn-add { background: var(--color-surface); color: var(--color-gold); }
        .btn-add:hover { background: var(--color-gold); color: var(--color-surface); }
        .btn-cancel { background: #6c757d; color: #fff; border-color: #6c757d; }
        .btn-cancel:hover { background: #5a6268; border-color: #5a6268; }
        .btn-save-sound { background: #27ae60; color: #fff; border-color: #27ae60; }
        .btn-save-sound:hover { background: #219a52; border-color: #219a52; }
        .btn-test-notif { background: var(--color-gold); color: var(--color-surface); border-color: var(--color-gold-dark); }
        .btn-test-notif:hover { background: var(--color-gold-dark); color: var(--color-surface); }
        .sound-settings {
            margin-top: 1.5rem;
            padding-top: 1.25rem;
            border-top: 3px dashed var(--color-gold);
        }
        .theme-preview-settings {
            margin-top: 1.25rem;
            padding-top: 1.25rem;
            border-top: 3px dashed var(--color-gold);
        }
        .theme-preview-settings .theme-select,
        .theme-preview-settings select {
            padding: 0.45rem 0.85rem;
            border-radius: var(--radius-full);
            border: 2px solid var(--color-gold);
            background: var(--color-card-bg);
            color: var(--color-text);
            font-family: Vazir, sans-serif;
            font-size: 0.875rem;
        }
        .designer-footer {
            margin-top: clamp(2rem, 5vw, 3rem);
            text-align: center;
            background: linear-gradient(145deg, var(--color-surface), var(--color-surface-light));
            padding: clamp(1rem, 3vw, 1.5rem);
            border-radius: var(--radius-xl) var(--radius-xl) var(--radius-lg) var(--radius-lg);
            border: 2px solid var(--color-gold);
            box-shadow: 0 -4px 0 var(--color-gold-press);
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            transition: background 0.5s ease, border-color 0.5s ease;
        }
        .designer-footer p {
            color: var(--color-gold);
            font-size: clamp(1rem, 2.5vw, 1.15rem);
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.6rem;
            flex-wrap: wrap;
        }
        .designer-footer i { color: var(--color-gold-light); font-size: 1.35rem; }
        .designer-footer .name {
            background: var(--color-gold);
            color: var(--color-surface);
            padding: 0.25rem 1rem;
            border-radius: var(--radius-full);
            font-weight: 800;
            font-size: 1.05rem;
        }
        .contact-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 2px dashed var(--color-gold);
        }
        .contact-info a {
            color: var(--color-gold-light);
            text-decoration: none;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            background: rgba(255,255,255,0.08);
            padding: 0.4rem 1rem;
            border-radius: var(--radius-full);
            transition: background 0.25s ease, color 0.25s ease;
            border: 1px solid var(--color-gold);
        }
        .contact-info a:hover { background: var(--color-gold); color: var(--color-surface); }
        @media (max-width: 700px) {
            .top-panel { flex-direction: column; align-items: stretch; }
            .login-simple { justify-content: center; }
        }
        .dynamic-wallpaper {
            contain: layout style paint;
        }
        .wallpaper-quality-settings {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 8px 12px;
            margin: 0 auto 8px;
            max-width: 500px;
            background: rgba(255,255,255,0.12);
            border-radius: var(--radius-full);
            border: 1px solid rgba(212,175,55,0.4);
        }
        .wallpaper-quality-settings label {
            font-weight: 600;
            color: var(--color-text);
            font-size: 0.9rem;
        }
        .wallpaper-quality-settings select {
            padding: 6px 12px;
            border-radius: 999px;
            border: 2px solid var(--color-gold);
            background: var(--color-surface);
            color: var(--color-text);
            font-size: 0.9rem;
            cursor: pointer;
        }
        body.theme-night .wallpaper-quality-settings {
            background: rgba(0,0,0,0.25);
            border-color: rgba(212,175,55,0.5);
        }
        body.theme-night .wallpaper-quality-settings select {
            background: rgba(0,0,0,0.3);
            color: var(--color-gold-light);
        }
        /* ÿØ⁄©ŸÖŸá Ÿà ŸæŸÜŸÑ ÿ™ŸÜÿ∏€åŸÖÿßÿ™ */
        .settings-trigger {
            position: absolute;
            top: 50%;
            right: 12px;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 2px solid var(--color-gold);
            background: rgba(255,255,255,0.15);
            color: var(--color-gold);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: background 0.2s ease, color 0.2s ease;
        }
        .settings-trigger:hover {
            background: var(--color-gold);
            color: var(--color-surface);
        }
        .settings-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .settings-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .settings-drawer {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            max-width: 320px;
            height: 100vh;
            background: var(--color-surface);
            box-shadow: -8px 0 24px rgba(0,0,0,0.3);
            z-index: 9999;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
            padding: 24px;
        }
        body.rtl .settings-drawer { right: auto; left: 0; transform: translateX(-100%); box-shadow: 8px 0 24px rgba(0,0,0,0.3); }
        .settings-drawer.open {
            transform: translateX(0);
        }
        body.rtl .settings-drawer.open { transform: translateX(0); }
        .settings-drawer h3 {
            margin: 0 0 20px 0;
            color: var(--color-gold);
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .settings-drawer .drawer-close {
            position: absolute;
            top: 16px;
            left: 16px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--color-gold);
            background: transparent;
            color: var(--color-gold);
            cursor: pointer;
            font-size: 1.1rem;
            transition: background 0.2s ease, color 0.2s ease;
        }
        body.rtl .settings-drawer .drawer-close { left: auto; right: 16px; }
        .settings-drawer .drawer-close:hover {
            background: var(--color-gold);
            color: var(--color-surface);
        }
        .settings-drawer .drawer-content { margin-top: 50px; }
        .settings-drawer .setting-group {
            margin-bottom: 20px;
        }
        .settings-drawer .setting-group label {
            display: block;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        .settings-drawer .setting-group select {
            width: 100%;
            padding: 10px 14px;
            border-radius: var(--radius-sm);
            border: 2px solid var(--color-gold);
            background: var(--color-surface-light);
            color: var(--color-text);
            font-size: 1rem;
        }
        .settings-drawer .drawer-link {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 12px 14px;
            border-radius: var(--radius-sm);
            border: 2px solid color-mix(in srgb, var(--color-gold) 55%, transparent);
            background: rgba(255,255,255,0.06);
            color: var(--color-text);
            text-decoration: none;
            font-weight: 700;
            margin-top: 10px;
        }
        .settings-drawer .drawer-link:hover {
            background: var(--color-gold);
            color: var(--color-surface);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="dynamic-wallpaper" id="dynamicWallpaper" aria-hidden="true">
        <img src="" alt="" class="wp-bg-image" id="wallpaperBg" aria-hidden="true">
        <div class="sky"></div>
        <img src="/icons/sun.svg" alt="" class="wp-sun" id="wallpaperSun" aria-hidden="true">
        <img src="/icons/moon.svg" alt="" class="wp-moon" id="wallpaperMoon" aria-hidden="true">
        <div class="clouds" aria-hidden="true">
            <img src="/icons/cloud.svg" alt="" class="wp-cloud wp-cloud-1">
            <img src="/icons/cloud.svg" alt="" class="wp-cloud wp-cloud-2">
            <img src="/icons/cloud.svg" alt="" class="wp-cloud wp-cloud-3">
        </div>
        <div class="stars" id="starsContainer"></div>
        <div class="particles" id="particlesContainer"></div>
        <img src="/icons/ground-spring.svg" alt="" class="wp-ground wp-ground-spring" aria-hidden="true">
        <img src="/icons/ground-summer.svg" alt="" class="wp-ground wp-ground-summer" aria-hidden="true">
        <img src="/icons/ground-autumn.svg" alt="" class="wp-ground wp-ground-autumn" aria-hidden="true">
        <img src="/icons/ground-snow.svg" alt="" class="wp-ground wp-ground-snow" aria-hidden="true">
        <img src="/icons/tree-spring.svg" alt="" class="wp-tree wp-tree-pos1 wp-tree-spring" aria-hidden="true">
        <img src="/icons/tree-summer.svg" alt="" class="wp-tree wp-tree-pos1 wp-tree-summer" aria-hidden="true">
        <img src="/icons/tree-autumn.svg" alt="" class="wp-tree wp-tree-pos1 wp-tree-autumn" aria-hidden="true">
        <img src="/icons/tree-winter.svg" alt="" class="wp-tree wp-tree-pos1 wp-tree-winter" aria-hidden="true">
        <img src="/icons/tree-spring.svg" alt="" class="wp-tree wp-tree-pos2 wp-tree-spring" aria-hidden="true">
        <img src="/icons/tree-summer.svg" alt="" class="wp-tree wp-tree-pos2 wp-tree-summer" aria-hidden="true">
        <img src="/icons/tree-autumn.svg" alt="" class="wp-tree wp-tree-pos2 wp-tree-autumn" aria-hidden="true">
        <img src="/icons/tree-winter.svg" alt="" class="wp-tree wp-tree-pos2 wp-tree-winter" aria-hidden="true">
        <img src="/icons/tree-spring.svg" alt="" class="wp-tree wp-tree-pos3 wp-tree-spring" aria-hidden="true">
        <img src="/icons/tree-summer.svg" alt="" class="wp-tree wp-tree-pos3 wp-tree-summer" aria-hidden="true">
        <img src="/icons/tree-autumn.svg" alt="" class="wp-tree wp-tree-pos3 wp-tree-autumn" aria-hidden="true">
        <img src="/icons/tree-winter.svg" alt="" class="wp-tree wp-tree-pos3 wp-tree-winter" aria-hidden="true">
    </div>
    <div class="container">
        <div class="header">
            <button type="button" class="settings-trigger" id="settingsTrigger" aria-label="ÿ™ŸÜÿ∏€åŸÖÿßÿ™" style="display:none;">
                <i class="fas fa-cog"></i>
            </button>
            <h1>
                <img src="/icons/icon-192x192.png" alt="ŸÑŸà⁄ØŸà€å ÿ®ÿ±ŸÜÿßŸÖŸá" style="height: 60px; margin-left: 15px; border-radius: 50%; background-color: #d4af37; padding: 5px;">
                ÿ®ÿ±ŸÜÿßŸÖŸá ⁄©ŸÑÿßÿ≥€å ŸáŸàÿ¥ŸÖŸÜÿØ
                <i class="fas fa-map-pin"></i>
            </h1>
            <p>üéì ŸáŸÖ€åÿ¥Ÿá ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ÿå ŸáŸÖ€åÿ¥Ÿá ÿØÿ± ÿ¨ÿ±€åÿßŸÜ</p>
        </div>

        <div class="top-panel">
            <div class="datetime-panel">
                <div class="date-box" id="dateDisplay"><i class="fas fa-calendar-alt"></i> <span>ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å...</span></div>
                <div class="time-box" id="timeDisplay"><i class="fas fa-clock"></i> <span>--:--:--</span></div>
                <div class="notification-badge" id="notificationBadge"><i class="fas fa-bell"></i> <span id="notifText">ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÑÿßÿ≥‚ÄåŸáÿß...</span></div>
            </div>

            <div class="login-simple" id="loginContainer">
                <input type="email" id="email" placeholder="ÿß€åŸÖ€åŸÑ" value="">
                <input type="password" id="password" placeholder="ÿ±ŸÖÿ≤">
                <button onclick="login()"><i class="fas fa-sign-in-alt"></i> Ÿàÿ±ŸàÿØ</button>
                <button class="logout-btn" id="logoutBtn" onclick="logout()" style="display:none;"><i class="fas fa-sign-out-alt"></i> ÿÆÿ±Ÿàÿ¨</button>
            </div>
        </div>

        <div class="instruction" id="mainInstruction">
            <i class="fas fa-hand-pointer"></i> ÿ±Ÿà€å Ÿáÿ± ⁄©ÿßÿ±ÿ™ ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ ÿ™ÿß ÿ¨ÿ≤ÿ¶€åÿßÿ™ ⁄©ÿßŸÖŸÑ ÿØÿ±ÿ≥ ÿ®ÿßÿ≤ ÿ¥ŸàÿØ <i class="fas fa-chevron-down"></i>
        </div>
        <div class="offline-banner" id="offlineBanner" style="display:none;">
            <i class="fas fa-wifi"></i> ÿ¥ŸÖÿß ÿ¢ŸÅŸÑÿß€åŸÜ Ÿáÿ≥ÿ™€åÿØ ‚Äî ÿØÿ± ÿ≠ÿßŸÑ ŸÜŸÖÿß€åÿ¥ ÿ¢ÿÆÿ±€åŸÜ ÿØÿßÿØŸá‚ÄåŸáÿß€å ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ¥ÿØŸá
        </div>

        <div class="card-grid" id="cardGrid"></div>

        <div class="add-course-section" id="adminSection">
            <h3 style="color: #1a1a1a; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-plus-circle" style="color: #b8860b;"></i> <span id="formTitle">ÿßŸÅÿ≤ŸàÿØŸÜ ÿØÿ±ÿ≥ ÿ¨ÿØ€åÿØ</span>
            </h3>
            <div class="add-course-form" id="courseForm">
                <input type="hidden" id="editId" value="">
                <div class="form-group"><label><i class="fas fa-book"></i> ŸÜÿßŸÖ ÿØÿ±ÿ≥</label><input type="text" id="courseName" placeholder="ŸÖÿ´ÿßŸÑ: ÿ±€åÿßÿ∂€å"></div>
                <div class="form-group"><label><i class="fas fa-hashtag"></i> ⁄©ÿØ ÿØÿ±ÿ≥</label><input type="text" id="courseCode" placeholder="ŸÖÿ´ÿßŸÑ: €±€≤€≥€¥"></div>
                <div class="form-group"><label><i class="fas fa-calendar-day"></i> ÿ±Ÿàÿ≤ ŸáŸÅÿ™Ÿá</label>
                    <select id="courseDay"><option value="0">ÿ¥ŸÜÿ®Ÿá</option><option value="1">€å⁄©‚Äåÿ¥ŸÜÿ®Ÿá</option><option value="2">ÿØŸàÿ¥ŸÜÿ®Ÿá</option><option value="3">ÿ≥Ÿá‚Äåÿ¥ŸÜÿ®Ÿá</option><option value="4">⁄ÜŸáÿßÿ±ÿ¥ŸÜÿ®Ÿá</option><option value="5">ŸæŸÜÿ¨‚Äåÿ¥ŸÜÿ®Ÿá</option><option value="6">ÿ¨ŸÖÿπŸá</option></select>
                </div>
                <div class="form-group"><label><i class="fas fa-clock"></i> ÿ≥ÿßÿπÿ™ ÿ¥ÿ±Ÿàÿπ</label><input type="time" id="startTime" value="08:00"></div>
                <div class="form-group"><label><i class="fas fa-clock"></i> ÿ≥ÿßÿπÿ™ Ÿæÿß€åÿßŸÜ</label><input type="time" id="endTime" value="10:00"></div>
                <div class="form-group"><label><i class="fas fa-chalkboard-teacher"></i> ÿßÿ≥ÿ™ÿßÿØ</label><input type="text" id="professor" placeholder="ŸÜÿßŸÖ ÿßÿ≥ÿ™ÿßÿØ"></div>
                <div class="form-group"><label><i class="fas fa-map-marker-alt"></i> ŸÖ⁄©ÿßŸÜ</label><input type="text" id="location" placeholder="ÿØÿßŸÜÿ¥⁄©ÿØŸá"></div>
                <div class="form-group"><label><i class="fas fa-users-between-lines"></i> ⁄Øÿ±ŸàŸá ÿØÿ±ÿ≥€å</label><input type="text" id="courseGroup" placeholder="ŸÖÿ´ÿßŸÑ: €±€±€±€¥" value="---"></div>
                <div class="form-group"><label><i class="fas fa-calculator"></i> Ÿàÿßÿ≠ÿØ ÿ™ÿ¶Ÿàÿ±€å</label><input type="number" step="0.1" min="0" id="theoretical" value="0.0"></div>
                <div class="form-group"><label><i class="fas fa-calculator"></i> Ÿàÿßÿ≠ÿØ ÿπŸÖŸÑ€å</label><input type="number" step="0.1" min="0" id="practical" value="0.0"></div>
                <div class="form-group"><label><i class="fas fa-calculator"></i> Ÿàÿßÿ≠ÿØ ⁄©ŸÑ</label><input type="number" step="0.1" min="0" id="total" value="0.0"></div>
                <div class="form-group checkbox-group">
                    <label><i class="fas fa-globe"></i> ÿ¢ŸÜŸÑÿß€åŸÜ</label>
                    <input type="checkbox" id="isOnline" style="width:20px; height:20px;">
                </div>
                <div class="form-group" id="onlineLinkGroup" style="display:none;">
                    <label><i class="fas fa-link"></i> ŸÑ€åŸÜ⁄© ÿ¨ŸÑÿ≥Ÿá</label>
                    <input type="url" id="onlineLink" placeholder="https://">
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn-add" onclick="saveCourse()"><i class="fas fa-save"></i> ÿ∞ÿÆ€åÿ±Ÿá</button>
                    <button class="btn-cancel" onclick="cancelEdit()"><i class="fas fa-times"></i> ŸÑÿ∫Ÿà</button>
                </div>
            </div>

            <div class="sound-settings">
                <h4 style="color: #1a1a1a; margin-bottom: 15px;"><i class="fas fa-music"></i> ÿ™ŸÜÿ∏€åŸÖ ÿµÿØÿß€å ÿ≤ŸÜ⁄Ø</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                    <input type="url" id="bellSoundUrl" placeholder="ŸÑ€åŸÜ⁄© ŸÅÿß€åŸÑ ÿµŸàÿ™€å (MP3)" style="flex: 1; min-width: 250px; padding: 10px; border-radius: 40px; border: 2px solid #d4af37;" value="https://bigsoundbank.com/UPLOAD/mp3/1500.mp3">
                    <button class="btn-save-sound" onclick="saveBellSound()"><i class="fas fa-save"></i> ÿ∞ÿÆ€åÿ±Ÿá ÿ≤ŸÜ⁄Ø</button>
                    <button class="btn-cancel" onclick="playTestBell()"><i class="fas fa-play"></i> ÿ™ÿ≥ÿ™ ÿ≤ŸÜ⁄Ø</button>
                    <button type="button" class="btn-test-notif" id="testNotificationBtn" onclick="testNotification()" style="display:none;"><i class="fas fa-bell"></i> ÿ™ÿ≥ÿ™ ŸÜŸàÿ™€åŸÅ</button>
                </div>
                <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">ÿß⁄Øÿ± ÿµÿØÿß ŸæÿÆÿ¥ ŸÜÿ¥ÿØÿå ÿ±Ÿà€å "ÿ™ÿ≥ÿ™ ÿ≤ŸÜ⁄Ø" ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ Ÿà ÿ≥Ÿæÿ≥ ÿßÿ¨ÿßÿ≤Ÿá ÿØŸá€åÿØ ŸÖÿ±Ÿàÿ±⁄Øÿ± ÿµÿØÿß ÿ±ÿß ŸæÿÆÿ¥ ⁄©ŸÜÿØ.</p>
            </div>

            <div class="theme-preview-settings">
                <h4 style="color: #1a1a1a; margin-bottom: 15px;"><i class="fas fa-palette"></i> Ÿæ€åÿ¥‚ÄåŸÜŸÖÿß€åÿ¥ ÿ™ŸÖ Ÿà ŸÅÿµŸÑ (ŸÅŸÇÿ∑ ÿ®ÿ±ÿß€å ÿ™ÿ≥ÿ™)</h4>
                <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-weight: 700; color: #1a1a1a;">ÿ™ŸÖ:</label>
                        <select id="wallpaperThemeSelect" onchange="applyWallpaperPreview()" class="theme-select">
                            <option value="auto">ÿÆŸàÿØ⁄©ÿßÿ± (ÿ®ÿ± ÿßÿ≥ÿßÿ≥ ŸàŸÇÿ™)</option>
                            <option value="day">ÿ±Ÿàÿ≤</option>
                            <option value="night">ÿ¥ÿ®</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-weight: 700; color: #1a1a1a;">ŸÅÿµŸÑ:</label>
                        <select id="wallpaperSeasonSelect" onchange="applyWallpaperPreview()" class="theme-select">
                            <option value="auto">ÿÆŸàÿØ⁄©ÿßÿ± (ÿ®ÿ± ÿßÿ≥ÿßÿ≥ ÿ™ÿßÿ±€åÿÆ)</option>
                            <option value="winter">ÿ≤ŸÖÿ≥ÿ™ÿßŸÜ (ÿ®ÿ±ŸÅ)</option>
                            <option value="spring">ÿ®Ÿáÿßÿ± (⁄ØŸÑÿ®ÿ±⁄Ø)</option>
                            <option value="summer">ÿ™ÿßÿ®ÿ≥ÿ™ÿßŸÜ (ÿ®ÿ±⁄Ø ÿ≥ÿ®ÿ≤)</option>
                            <option value="autumn">Ÿæÿß€å€åÿ≤ (ÿ®ÿ±⁄Ø Ÿæÿß€å€åÿ≤€å)</option>
                        </select>
                    </div>
                </div>
                <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">ÿ®ÿß ¬´ÿÆŸàÿØ⁄©ÿßÿ±¬ª ÿ™ŸÖ Ÿà ŸÅÿµŸÑ ÿ∑ÿ®ŸÇ ŸàŸÇÿ™ ÿ™Ÿáÿ±ÿßŸÜ ÿ™ŸÜÿ∏€åŸÖ ŸÖ€å‚Äåÿ¥ŸàÿØ.</p>
            </div>
        </div>

        <div class="designer-footer">
            <p><i class="fas fa-paint-brush"></i> ÿ∑ÿ±ÿßÿ≠€å Ÿà ÿ™Ÿàÿ≥ÿπŸá ÿ™Ÿàÿ≥ÿ∑ <span class="name">ŸÖÿ≠ŸÖÿØ ŸÖŸáÿØ€å ŸÖŸàŸÑÿß€åÿßÿ±€å</span> <i class="fas fa-code"></i></p>
            <div class="contact-info">
                <a href="tel:+989375379205" dir="ltr"><i class="fas fa-phone-alt"></i> 09375379205</a>
                <a href="https://t.me/AE_MOLA" target="_blank"><i class="fab fa-telegram-plane"></i> t.me/AE_MOLA</a>
            </div>
        </div>
    </div>

    <div class="settings-overlay" id="settingsOverlay" aria-hidden="true"></div>
    <div class="settings-drawer" id="settingsDrawer" aria-label="ŸæŸÜŸÑ ÿ™ŸÜÿ∏€åŸÖÿßÿ™">
        <button type="button" class="drawer-close" id="settingsDrawerClose" aria-label="ÿ®ÿ≥ÿ™ŸÜ"><i class="fas fa-times"></i></button>
        <div class="drawer-content">
            <h3><i class="fas fa-cog"></i> ÿ™ŸÜÿ∏€åŸÖÿßÿ™</h3>
            <div class="setting-group">
                <label for="wallpaperQualitySelect"><i class="fas fa-tachometer-alt"></i> ⁄©€åŸÅ€åÿ™ Ÿæÿ≥‚Äåÿ≤ŸÖ€åŸÜŸá</label>
                <select id="wallpaperQualitySelect" aria-label="⁄©€åŸÅ€åÿ™ Ÿæÿ≥‚Äåÿ≤ŸÖ€åŸÜŸá">
                    <option value="fast">ÿ≥ÿ±€åÿπ (Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂)</option>
                    <option value="medium">ŸÖÿ™Ÿàÿ≥ÿ∑</option>
                    <option value="high">ŸÇŸà€å</option>
                </select>
            </div>
            <a class="drawer-link" href="/settings.html">
                <i class="fas fa-eye"></i>
                <span>Ÿæÿ±€åŸà€åŸà Ÿà ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ÿµÿ≠ŸÜŸá</span>
            </a>
        </div>
    </div>

    <audio id="bellSound" preload="auto"></audio>

    <script>
        (function settingsDrawer() {
            var overlay = document.getElementById('settingsOverlay');
            var drawer = document.getElementById('settingsDrawer');
            var trigger = document.getElementById('settingsTrigger');
            var closeBtn = document.getElementById('settingsDrawerClose');
            function openDrawer() {
                if (overlay) overlay.classList.add('open');
                if (drawer) drawer.classList.add('open');
            }
            function closeDrawer() {
                if (overlay) overlay.classList.remove('open');
                if (drawer) drawer.classList.remove('open');
            }
            if (trigger) trigger.addEventListener('click', openDrawer);
            if (closeBtn) closeBtn.addEventListener('click', closeDrawer);
            if (overlay) overlay.addEventListener('click', closeDrawer);
        })();
    </script>
    <script>
        (function() {
            const supabaseUrl = 'https://kssamzssqvkmsdgljlem.supabase.co';
            const supabaseAnonKey = 'sb_publishable_-XVb7eOpQzabcePWvfc9NA_x0fXhFSf';
            
            const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey, {
                auth: { persistSession: true, autoRefreshToken: true }
            });

            const TEHRAN_OFFSET = 3.5 * 60 * 60 * 1000;
            let coursesData = [];
            let isLoggedIn = false;
            let bellPlayed = [];
            let unsubscribeCourses = null;
            let unsubscribeSettings = null;
            const bellSound = document.getElementById('bellSound');
            let bellSoundUrl = "https://bigsoundbank.com/UPLOAD/mp3/1500.mp3";

            /** ŸÑ€åÿ≥ÿ™ ŸÜŸàÿ™€åŸÅ‚ÄåŸáÿß€å ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤€å‚Äåÿ¥ÿØŸá: { showAt, title, body, id } ‚Äî ÿ®ÿß setInterval ⁄Ü⁄© ŸÖ€å‚Äåÿ¥ŸàÿØ ÿ™ÿß ÿ®ÿß ÿ™ÿ® ÿ®ÿ≥ÿ™Ÿá/ŸÖ€åŸÜ€åŸÖÿß€åÿ≤ ŸáŸÖ Ÿæÿß€åÿØÿßÿ± ÿ®ŸÖÿßŸÜÿØ */
            let pendingNotifications = [];
            let notificationCheckInterval = null;
            const NOTIFICATION_CHECK_MS = 10 * 1000;
            const NOTIFICATION_MINUTES_BEFORE = 5;

            function clearAllNotifications() {
                pendingNotifications = [];
                if (notificationCheckInterval) {
                    clearInterval(notificationCheckInterval);
                    notificationCheckInterval = null;
                }
            }

            async function requestNotificationPermission() {
                if (!('Notification' in window)) return 'unsupported';
                if (Notification.permission === 'granted') return 'granted';
                if (Notification.permission === 'denied') return 'denied';
                const perm = await Notification.requestPermission();
                return perm;
            }

            /** ŸÜŸÖÿß€åÿ¥ ŸÜŸàÿ™€åŸÅ: ÿØÿ± ŸÖŸàÿ®ÿß€åŸÑ ÿßÿ≤ SW (Ÿæÿß€åÿØÿßÿ±ÿ™ÿ±)ÿå ÿØÿ± ÿØÿ≥⁄©ÿ™ÿßŸæ ÿßÿ≤ ÿµŸÅÿ≠Ÿá €åÿß SW */
            async function showNotification(title, body) {
                if (!('Notification' in window)) return;
                if (Notification.permission !== 'granted') return;
                const t = title || '€åÿßÿØÿ¢Ÿàÿ± ⁄©ŸÑÿßÿ≥';
                const b = body || '';
                const tag = 'notif-' + Date.now();
                try {
                    const reg = await navigator.serviceWorker.ready;
                    if (reg.active) {
                        reg.active.postMessage({ type: 'SHOW_NOTIFICATION', title: t, body: b, tag });
                        return;
                    }
                } catch (e) {}
                try {
                    new Notification(t, { body: b, icon: '/icons/icon-192x192.png', tag });
                } catch (err) {
                    try { new Notification(t, { body: b, tag }); } catch (e2) { console.warn('ŸÜŸÖÿß€åÿ¥ ŸÜŸàÿ™€åŸÅ:', err); }
                }
            }

            /** ÿ≤ŸÖÿßŸÜ ŸÜŸÖÿß€åÿ¥ ŸÜŸàÿ™€åŸÅ (UTC ms): ÿØŸÇ€åŸÇÿßŸã ŸàŸÇÿ™€å ÿØÿ± ÿ™Ÿáÿ±ÿßŸÜ cardDay Ÿà startHour:startMin ÿßÿ≥ÿ™ÿå ŸÖŸÜŸáÿß€å minutesBefore */
            function getNextNotificationTime(course, minutesBefore) {
                const now = Date.now();
                const tehranNow = now + TEHRAN_OFFSET;
                const tehranDate = new Date(tehranNow);
                const currentDay = (tehranDate.getUTCDay() + 1) % 7;
                const currentHour = tehranDate.getUTCHours();
                const currentMin = tehranDate.getUTCMinutes();
                const currentMinutes = currentHour * 60 + currentMin;

                const cardDay = course.dayIndex;
                const startHour = parseInt(String(course.startTime || '08:00').split(':')[0], 10);
                const startMin = parseInt(String(course.startTime || '08:00').split(':')[1], 10) || 0;
                const startTotal = startHour * 60 + startMin;

                let diffDays = (cardDay - currentDay + 7) % 7;
                if (diffDays === 0 && currentMinutes >= startTotal) diffDays = 7;

                const targetTehran = tehranNow + diffDays * 86400000;
                const targetTehranMidnight = Math.floor(targetTehran / 86400000) * 86400000;
                const classStartUTC = (targetTehranMidnight - TEHRAN_OFFSET) + (startHour * 60 + startMin) * 60 * 1000;
                return classStartUTC - minutesBefore * 60 * 1000;
            }

            function scheduleClassNotification(course, minutesBefore) {
                minutesBefore = minutesBefore ?? NOTIFICATION_MINUTES_BEFORE;
                if (!('Notification' in window)) return;

                const now = Date.now();
                const showAt = getNextNotificationTime(course, minutesBefore);
                const maxFuture = 7 * 24 * 60 * 60 * 1000;
                if (showAt <= now || showAt - now > maxFuture) return;

                const id = (course.id || course.name) + '-' + showAt;
                if (pendingNotifications.some(n => n.id === id)) return;
                pendingNotifications.push({
                    id,
                    showAt,
                    title: '€åÿßÿØÿ¢Ÿàÿ± ⁄©ŸÑÿßÿ≥',
                    body: `⁄©ŸÑÿßÿ≥ ¬´${course.name}¬ª ÿ™ÿß ${minutesBefore} ÿØŸÇ€åŸÇŸá ÿØ€å⁄Øÿ± ÿ¥ÿ±Ÿàÿπ ŸÖ€å‚Äåÿ¥ŸàÿØ.`
                });
            }

            function runNotificationCheck() {
                if (Notification.permission !== 'granted') return;
                const now = Date.now();
                const windowMs = 2 * 60 * 1000;
                const toShow = pendingNotifications.filter(n => n.showAt <= now + windowMs);
                pendingNotifications = pendingNotifications.filter(n => n.showAt > now + windowMs);
                toShow.forEach(n => {
                    showNotification(n.title, n.body);
                });
            }

            function startNotificationScheduler() {
                if (notificationCheckInterval) return;
                runNotificationCheck();
                notificationCheckInterval = setInterval(runNotificationCheck, NOTIFICATION_CHECK_MS);
                document.addEventListener('visibilitychange', function() {
                    if (document.visibilityState === 'visible') runNotificationCheck();
                });
            }

            function rescheduleAllNotifications() {
                if (Notification.permission !== 'granted') return;
                pendingNotifications = [];
                if (Array.isArray(coursesData) && coursesData.length) {
                    coursesData.forEach(course => scheduleClassNotification(course));
                }
                startNotificationScheduler();
            }

            function setOfflineBanner(show) {
                const el = document.getElementById('offlineBanner');
                if (el) el.style.display = show ? 'block' : 'none';
            }

            async function loadCoursesWithCache() {
                clearAllNotifications();

                const cached = localStorage.getItem('cachedCourses');
                if (cached) {
                    try {
                        const parsed = JSON.parse(cached);
                        coursesData = Array.isArray(parsed) ? parsed : [];
                        renderCards();
                        updateCountdownsAndBell();
                        coursesData.forEach(course => scheduleClassNotification(course));
                        startNotificationScheduler();
                    } catch (e) {}
                }

                if (!navigator.onLine) {
                    setOfflineBanner(true);
                    return;
                }
                setOfflineBanner(false);

                try {
                    const { data, error } = await supabase
                        .from('courses')
                        .select('*')
                        .order('dayIndex', { ascending: true })
                        .order('startTime', { ascending: true });
                    if (!error && data && Array.isArray(data)) {
                        coursesData = data;
                        localStorage.setItem('cachedCourses', JSON.stringify(data));
                        resetBellPlayed();
                        renderCards();
                        updateCountdownsAndBell();
                        data.forEach(course => scheduleClassNotification(course));
                        startNotificationScheduler();
                    }
                } catch (e) {
                    console.warn('ÿÆÿ∑ÿß ÿØÿ± ÿØÿ±€åÿßŸÅÿ™ ÿßÿ≤ ÿ¥ÿ®⁄©Ÿáÿõ ŸÜŸÖÿß€åÿ¥ ÿØÿßÿØŸá‚ÄåŸáÿß€å ⁄©ÿ¥‚Äåÿ¥ÿØŸá ÿ®ÿØŸàŸÜ ÿ™ÿ∫€å€åÿ±', e);
                    setOfflineBanner(true);
                }
            }

            async function subscribeToSettings() {
                if (unsubscribeSettings) unsubscribeSettings();
                const { data, error } = await supabase
                    .from('settings')
                    .select('*')
                    .eq('id', 'general')
                    .single();
                if (data) {
                    bellSoundUrl = data.bellSoundUrl || bellSoundUrl;
                }
                if (isLoggedIn) {
                    document.getElementById('bellSoundUrl').value = bellSoundUrl;
                }
            }

            window.saveBellSound = async function() {
                const newUrl = document.getElementById('bellSoundUrl').value.trim();
                if (!newUrl) { alert('ŸÑÿ∑ŸÅÿßŸã ŸÑ€åŸÜ⁄© ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ'); return; }
                try {
                    const { error } = await supabase
                        .from('settings')
                        .upsert({ id: 'general', bellSoundUrl: newUrl });
                    if (error) throw error;
                    alert('ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ÿ≤ŸÜ⁄Ø ÿ∞ÿÆ€åÿ±Ÿá ÿ¥ÿØ');
                    bellSoundUrl = newUrl;
                } catch (error) {
                    alert('ÿÆÿ∑ÿß ÿØÿ± ÿ∞ÿÆ€åÿ±Ÿá: ' + error.message);
                }
            };

            window.playTestBell = function() {
                const testUrl = document.getElementById('bellSoundUrl').value.trim() || bellSoundUrl;
                const audio = new Audio(testUrl);
                audio.play().catch(e => {
                    alert('ŸæÿÆÿ¥ ÿµÿØÿß ŸÖŸÖ⁄©ŸÜ ŸÜ€åÿ≥ÿ™. ŸÑÿ∑ŸÅÿßŸã ÿ±Ÿà€å ÿµŸÅÿ≠Ÿá ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ Ÿà ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ÿ≥ÿ™ ⁄©ŸÜ€åÿØ.\nÿÆÿ∑ÿß: ' + e.message);
                });
            };

            window.login = async function() {
                const email = document.getElementById('email').value;
                const pass = document.getElementById('password').value;
                try {
                    const { data, error } = await supabase.auth.signInWithPassword({ email, password: pass });
                    if (error) throw error;
                    isLoggedIn = true;
                    updateLoginUI();
                    requestNotificationPermission();
                    await loadCoursesWithCache();
                } catch (error) {
                    alert('ÿÆÿ∑ÿß ÿØÿ± Ÿàÿ±ŸàÿØ: ' + error.message);
                }
            };

            window.logout = async function() {
                await supabase.auth.signOut();
                isLoggedIn = false;
                updateLoginUI();
                cancelEdit();
                await loadCoursesWithCache();
            };

            async function checkAuthState() {
                const { data: { user } } = await supabase.auth.getUser();
                isLoggedIn = !!user;
                updateLoginUI();
            }

            supabase.auth.onAuthStateChange((event, session) => {
                isLoggedIn = !!session?.user;
                updateLoginUI();
                if (event === 'SIGNED_IN' || event === 'SIGNED_OUT') {
                    loadCoursesWithCache();
                }
            });

            function updateLoginUI() {
                const emailInput = document.getElementById('email');
                const passwordInput = document.getElementById('password');
                const loginBtn = document.querySelector('#loginContainer button[onclick="login()"]');
                const logoutBtn = document.getElementById('logoutBtn');
                const adminSection = document.getElementById('adminSection');
                const testNotifBtn = document.getElementById('testNotificationBtn');
                const settingsTrigger = document.getElementById('settingsTrigger');

                if (isLoggedIn) {
                    emailInput.style.display = 'none';
                    passwordInput.style.display = 'none';
                    loginBtn.style.display = 'none';
                    logoutBtn.style.display = 'inline-block';
                    adminSection.classList.add('visible');
                    document.getElementById('bellSoundUrl').value = bellSoundUrl;
                    if (testNotifBtn) testNotifBtn.style.display = 'inline-block';
                    if (settingsTrigger) settingsTrigger.style.display = 'inline-flex';
                } else {
                    emailInput.style.display = 'inline-block';
                    passwordInput.style.display = 'inline-block';
                    loginBtn.style.display = 'inline-flex';
                    logoutBtn.style.display = 'none';
                    adminSection.classList.remove('visible');
                    if (testNotifBtn) testNotifBtn.style.display = 'none';
                    if (settingsTrigger) settingsTrigger.style.display = 'none';
                }
            }

            window.testNotification = async function() {
                if (!('Notification' in window)) {
                    alert('ŸÖÿ±Ÿàÿ±⁄Øÿ± ÿ¥ŸÖÿß ŸÜŸàÿ™€åŸÅ€å⁄©€åÿ¥ŸÜ Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ŸÜŸÖ€å‚Äå⁄©ŸÜÿØ.');
                    return;
                }
                if (!window.isSecureContext) {
                    alert('ŸÜŸàÿ™€åŸÅ€å⁄©€åÿ¥ŸÜ ŸÅŸÇÿ∑ ÿ±Ÿà€å ÿ¢ÿØÿ±ÿ≥ ÿßŸÖŸÜ (https €åÿß localhost) ⁄©ÿßÿ± ŸÖ€å‚Äå⁄©ŸÜÿØ. ŸÅÿß€åŸÑ ÿ±ÿß ŸÖÿ≥ÿ™ŸÇ€åŸÖ ÿ®ÿßÿ≤ ŸÜ⁄©ŸÜ€åÿØÿõ ÿ≥ÿß€åÿ™ ÿ±ÿß ÿ®ÿß €å⁄© ÿ≥ÿ±Ÿàÿ± ŸÑŸà⁄©ÿßŸÑ €åÿß Ÿáÿßÿ≥ÿ™ ÿßÿ¨ÿ±ÿß ⁄©ŸÜ€åÿØ.');
                    return;
                }
                let perm = Notification.permission;
                if (perm !== 'granted') {
                    perm = await Notification.requestPermission();
                    if (perm !== 'granted') {
                        alert('ÿßÿ¨ÿßÿ≤Ÿá ÿßÿπŸÑÿßŸÜ ÿØÿßÿØŸá ŸÜÿ¥ÿØ. ÿ®ÿ±ÿß€å €åÿßÿØÿ¢Ÿàÿ± ⁄©ŸÑÿßÿ≥‚ÄåŸáÿß ÿØÿ± ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ŸÖÿ±Ÿàÿ±⁄Øÿ± ÿßÿ¨ÿßÿ≤ŸáŸî ¬´ÿßÿπŸÑÿßŸÜ‚ÄåŸáÿß¬ª ÿ±ÿß ÿ®ÿ±ÿß€å ÿß€åŸÜ ÿ≥ÿß€åÿ™ ŸÅÿπÿßŸÑ ⁄©ŸÜ€åÿØ.');
                        return;
                    }
                }
                showNotification('ÿ™ÿ≥ÿ™ ŸÜŸàÿ™€åŸÅ', 'ÿß€åŸÜ €å⁄© Ÿæ€åÿßŸÖ ÿ™ÿ≥ÿ™€å ÿßÿ≤ ÿ∑ÿ±ŸÅ ÿßÿØŸÖ€åŸÜ ÿßÿ≥ÿ™.');
                rescheduleAllNotifications();
            };

            function resetBellPlayed() { bellPlayed = new Array(coursesData.length).fill(false); }
            function timeToMinutes(t) { if (!t) return 0; let p = t.split(':'); return parseInt(p[0])*60 + parseInt(p[1]); }
            function getDayName(d) { return ['ÿ¥ŸÜÿ®Ÿá','€å⁄©‚Äåÿ¥ŸÜÿ®Ÿá','ÿØŸàÿ¥ŸÜÿ®Ÿá','ÿ≥Ÿá‚Äåÿ¥ŸÜÿ®Ÿá','⁄ÜŸáÿßÿ±ÿ¥ŸÜÿ®Ÿá','ŸæŸÜÿ¨‚Äåÿ¥ŸÜÿ®Ÿá','ÿ¨ŸÖÿπŸá'][d]; }

            function sortCoursesWithPinned(tehranNow, currentDay, currentMinutes) {
                return [...coursesData].sort((a, b) => {
                    const aPinned = isPinned(a, currentDay, currentMinutes);
                    const bPinned = isPinned(b, currentDay, currentMinutes);
                    if (aPinned && !bPinned) return -1;
                    if (!aPinned && bPinned) return 1;
                    if (a.dayIndex !== b.dayIndex) return (a.dayIndex || 0) - (b.dayIndex || 0);
                    return timeToMinutes(a.startTime) - timeToMinutes(b.startTime);
                });
            }

            function isPinned(course, currentDay, currentMinutes) {
                if (course.dayIndex !== currentDay) return false;
                const end = timeToMinutes(course.endTime);
                return currentMinutes < end;
            }

            function renderCards() {
                const nowUTC = Date.now();
                const tehranNow = nowUTC + TEHRAN_OFFSET;
                const tehranDate = new Date(tehranNow);
                const jsDay = tehranDate.getUTCDay();
                const currentDay = (jsDay + 1) % 7;
                const currentHour = tehranDate.getUTCHours();
                const currentMin = tehranDate.getUTCMinutes();
                const currentMinutes = currentHour * 60 + currentMin;

                const sorted = sortCoursesWithPinned(tehranNow, currentDay, currentMinutes);

                const grid = document.getElementById('cardGrid');
                grid.innerHTML = '';
                if (sorted.length === 0) {
                    grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px; background:#fff9e6; border-radius:60px; border:2px dashed #d4af37;">Ÿá€å⁄Ü ÿØÿ±ÿ≥€å €åÿßŸÅÿ™ ŸÜÿ¥ÿØ. ÿßŸàŸÑ€åŸÜ ÿØÿ±ÿ≥ ÿ±ÿß ÿßÿ∂ÿßŸÅŸá ⁄©ŸÜ€åÿØ.</div>';
                    return;
                }
                sorted.forEach((course) => {
                    const startH = parseInt(course.startTime?.split(':')[0] || 0);
                    const startM = parseInt(course.startTime?.split(':')[1] || 0);
                    const card = document.createElement('div');
                    card.className = 'course-card';
                    card.setAttribute('data-id', course.id);
                    card.setAttribute('data-day', course.dayIndex);
                    card.setAttribute('data-start-hour', startH);
                    card.setAttribute('data-start-min', startM);
                    card.setAttribute('onclick', 'toggleCard(this)');

                    let adminDiv = '';
                    if (isLoggedIn) {
                        adminDiv = `
                            <div class="admin-controls">
                                <div class="edit-btn" onclick="event.stopPropagation(); editCourse('${course.id}')"><i class="fas fa-edit"></i></div>
                                <div class="delete-btn" onclick="event.stopPropagation(); deleteCourse('${course.id}')"><i class="fas fa-trash"></i></div>
                            </div>
                        `;
                    }

                    let onlineBadge = '', onlineLink = '';
                    if (course.isOnline) {
                        onlineBadge = '<div class="online-badge"><i class="fas fa-wifi"></i> ÿ¢ŸÜŸÑÿß€åŸÜ</div>';
                        if (course.onlineLink) {
                            onlineLink = `<div class="online-link"><a href="${course.onlineLink}" target="_blank"><i class="fas fa-external-link-alt"></i> ŸÑ€åŸÜ⁄© ÿ¨ŸÑÿ≥Ÿá</a></div>`;
                        }
                    }

                    const summary = document.createElement('div');
                    summary.className = 'card-summary';
                    summary.innerHTML = `
                        ${adminDiv}
                        <div class="day-time-badge"><i class="fas fa-calendar-day"></i> ${getDayName(course.dayIndex)} ${course.startTime}-${course.endTime}</div>
                        <span class="summary-course-name">${course.name}</span>
                        ${onlineBadge}
                        ${onlineLink}
                        <div class="countdown-area" id="countdown-${course.id}"><i class="fas fa-hourglass-half"></i><span>ÿØÿ± ÿ≠ÿßŸÑ ŸÖÿ≠ÿßÿ≥ÿ®Ÿá...</span></div>
                        <div class="expand-icon"><i class="fas fa-chevron-down"></i></div>
                    `;

                    const details = document.createElement('div');
                    details.className = 'card-details';
                    details.innerHTML = `
                        <div class="details-content">
                            <div class="course-code"><i class="fas fa-hashtag"></i> ${course.code}</div>
                            <div class="units-mini">
                                <span><i class="fas fa-chalkboard"></i> ÿ™ÿ¶Ÿàÿ±€å ${(course.theoretical||0).toFixed(1)}</span>
                                <span><i class="fas fa-flask"></i> ÿπŸÖŸÑ€å ${(course.practical||0).toFixed(1)}</span>
                                <span><i class="fas fa-layer-group"></i> ⁄©ŸÑ ${(course.total||0).toFixed(1)}</span>
                            </div>
                            <div class="info-row"><i class="fas fa-users-between-lines"></i> <span><strong>⁄Øÿ±ŸàŸá ${course.group_name || '---'}</strong> - ÿßÿ≥ÿ™ÿßÿØ: ${course.professor}</span></div>
                            <div class="info-row"><i class="fas fa-building-columns"></i> <span>${course.location}</span></div>
                            ${course.isOnline && course.onlineLink ? `<div class="info-row"><i class="fas fa-link"></i> <span><a href="${course.onlineLink}" target="_blank">ŸÑ€åŸÜ⁄© ÿ¨ŸÑÿ≥Ÿá</a></span></div>` : ''}
                            <div class="exam-simple">
                                <div class="exam-header"><i class="fas fa-pencil-alt"></i> ÿ¢ÿ≤ŸÖŸàŸÜ</div>
                                <div class="exam-detail-item"><i class="fas fa-calendar-alt"></i> <span>${course.examDate||'ŸÖÿ¥ÿÆÿµ ŸÜÿ¥ÿØŸá'} ${course.examTime?'<span class="exam-date-badge">'+course.examTime+'</span>':''}</span></div>
                                <div class="exam-detail-item"><i class="fas fa-hourglass-half"></i> ŸÖÿØÿ™: ${course.examDuration||'ŸÖÿ¥ÿÆÿµ ŸÜÿ¥ÿØŸá'}</div>
                                <div class="exam-detail-item"><i class="fas fa-map-pin"></i> ŸÖÿ≠ŸÑ: ${course.examLocation||'ŸÖÿ¥ÿÆÿµ ŸÜÿ¥ÿØŸá'}</div>
                            </div>
                        </div>
                    `;

                    card.appendChild(summary); card.appendChild(details);
                    grid.appendChild(card);
                });
            }

            function updateCountdownsAndBell() {
                const nowUTC = Date.now();
                const tehranNow = nowUTC + TEHRAN_OFFSET;
                const tehranDate = new Date(tehranNow);
                const jsDay = tehranDate.getUTCDay();
                const currentDay = (jsDay + 1) % 7;
                const currentHour = tehranDate.getUTCHours();
                const currentMin = tehranDate.getUTCMinutes();
                const currentSec = tehranDate.getUTCSeconds();
                const currentMinutes = currentHour * 60 + currentMin;

                const persianFormatter = new Intl.DateTimeFormat('fa-IR', { timeZone: 'Asia/Tehran', dateStyle: 'full' });
                document.getElementById('dateDisplay').innerHTML = `<i class="fas fa-calendar-alt"></i> ${persianFormatter.format(new Date())}`;
                document.getElementById('timeDisplay').innerHTML = `<i class="fas fa-clock"></i> ${currentHour.toString().padStart(2,'0')}:${currentMin.toString().padStart(2,'0')}:${currentSec.toString().padStart(2,'0')}`;

                const cards = document.querySelectorAll('.course-card');
                let upcomingCount = 0;

                cards.forEach(card => {
                    const courseId = card.getAttribute('data-id');
                    const course = coursesData.find(c => c.id == courseId);
                    if (!course) return;

                    const cardDay = course.dayIndex;
                    const startHour = parseInt(card.getAttribute('data-start-hour'));
                    const startMin = parseInt(card.getAttribute('data-start-min'));
                    const endHour = parseInt(course.endTime?.split(':')[0] || 0);
                    const endMin = parseInt(course.endTime?.split(':')[1] || 0);
                    const startTotal = startHour*60 + startMin;
                    const endTotal = endHour*60 + endMin;

                    card.classList.remove('today-highlight');
                    if (cardDay === currentDay && currentMinutes < endTotal) {
                        card.classList.add('today-highlight');
                        upcomingCount++;
                    }

                    let diffDays = (cardDay - currentDay + 7) % 7;
                    if (diffDays === 0 && currentMinutes >= startTotal) diffDays = 7;

                    const targetTehran = tehranNow + diffDays * 86400000;
                    const targetDate = new Date(targetTehran);
                    targetDate.setUTCHours(0,0,0,0);
                    const targetStartDay = targetDate.getTime();
                    const targetWithHour = targetStartDay + startHour*3600000 + startMin*60000;
                    const targetUTC = targetWithHour - TEHRAN_OFFSET;
                    let diffMs = targetUTC - nowUTC;
                    if (diffMs < 0) diffMs = 0;

                    let displayText = '';
                    const isNowOngoing = (cardDay === currentDay && currentMinutes >= startTotal && currentMinutes < endTotal);
                    if (isNowOngoing) {
                        displayText = '‚ö° ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿ±⁄Øÿ≤ÿßÿ±€å';
                    } else {
                        const totalSec = Math.floor(diffMs / 1000);
                        const days = Math.floor(totalSec / 86400);
                        const hours = Math.floor((totalSec % 86400) / 3600);
                        const mins = Math.floor((totalSec % 3600) / 60);
                        const secs = totalSec % 60;
                        if (days > 0) displayText = `‚è≥ ÿ™ÿß ÿ¥ÿ±Ÿàÿπ: ${days} ÿ±Ÿàÿ≤ ${hours} ÿ≥ÿßÿπÿ™`;
                        else if (hours > 0) displayText = `‚è≥ ÿ™ÿß ÿ¥ÿ±Ÿàÿπ: ${hours} ÿ≥ÿßÿπÿ™ ${mins} ÿØŸÇ€åŸÇŸá`;
                        else if (mins > 0) displayText = `‚è≥ ÿ™ÿß ÿ¥ÿ±Ÿàÿπ: ${mins} ÿØŸÇ€åŸÇŸá ${secs} ÿ´ÿßŸÜ€åŸá`;
                        else displayText = `‚è≥ ÿ™ÿß ÿ¥ÿ±Ÿàÿπ: ${secs} ÿ´ÿßŸÜ€åŸá`;
                    }

                    const countSpan = card.querySelector('.countdown-area span');
                    if (countSpan) countSpan.innerText = displayText;

                    const index = coursesData.findIndex(c => c.id == courseId);
                    if (index !== -1) {
                        if (isNowOngoing && !bellPlayed[index]) {
                            playBell();
                            bellPlayed[index] = true;
                        }
                        if (!isNowOngoing && bellPlayed[index]) {
                            bellPlayed[index] = false;
                        }
                    }
                });

                const notif = document.getElementById('notifText');
                if (upcomingCount === 0) notif.innerText = 'ÿßŸÖÿ±Ÿàÿ≤ ⁄©ŸÑÿßÿ≥ ÿ®ÿßŸÇ€å‚ÄåŸÖÿßŸÜÿØŸá ŸÜ€åÿ≥ÿ™';
                else if (upcomingCount === 1) notif.innerText = '‚ö†Ô∏è €± ⁄©ŸÑÿßÿ≥ ÿßŸÖÿ±Ÿàÿ≤ ÿ®ÿßŸÇ€å‚ÄåŸÖÿßŸÜÿØŸá';
                else notif.innerText = `‚ö†Ô∏è ${upcomingCount} ⁄©ŸÑÿßÿ≥ ÿßŸÖÿ±Ÿàÿ≤ ÿ®ÿßŸÇ€å‚ÄåŸÖÿßŸÜÿØŸá`;
            }

            function playBell() {
                if (bellSound) {
                    bellSound.src = bellSoundUrl;
                    bellSound.currentTime = 0;
                    bellSound.play().catch(e => {
                        console.log('ŸæÿÆÿ¥ ÿÆŸàÿØ⁄©ÿßÿ± ÿµÿØÿß ŸÖŸÖ⁄©ŸÜ ŸÜ€åÿ≥ÿ™', e);
                        if (!window.soundWarningShown) {
                            window.soundWarningShown = true;
                            alert('ÿ®ÿ±ÿß€å ÿ¥ŸÜ€åÿØŸÜ ÿµÿØÿß€å ÿ≤ŸÜ⁄Ø ⁄©ŸÑÿßÿ≥ÿå ŸÑÿ∑ŸÅÿßŸã ÿ±Ÿà€å ÿØ⁄©ŸÖŸá "ÿ™ÿ≥ÿ™ ÿ≤ŸÜ⁄Ø" ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ.');
                        }
                    });
                }
            }

            window.editCourse = function(id) {
                const course = coursesData.find(c => c.id == id);
                if (!course) return;
                document.getElementById('editId').value = id;
                document.getElementById('courseName').value = course.name || '';
                document.getElementById('courseCode').value = course.code || '';
                document.getElementById('courseDay').value = course.dayIndex || 0;
                document.getElementById('startTime').value = course.startTime || '08:00';
                document.getElementById('endTime').value = course.endTime || '10:00';
                document.getElementById('professor').value = course.professor || '';
                document.getElementById('location').value = course.location || '';
                document.getElementById('courseGroup').value = course.group_name || '---';
                document.getElementById('theoretical').value = course.theoretical || 0;
                document.getElementById('practical').value = course.practical || 0;
                document.getElementById('total').value = course.total || 0;
                document.getElementById('isOnline').checked = course.isOnline || false;
                document.getElementById('onlineLink').value = course.onlineLink || '';
                document.getElementById('onlineLinkGroup').style.display = course.isOnline ? 'block' : 'none';
                document.getElementById('formTitle').innerText = 'Ÿà€åÿ±ÿß€åÿ¥ ÿØÿ±ÿ≥';
                document.getElementById('adminSection').classList.add('visible');
            };

            window.deleteCourse = async function(id) {
                if (confirm('ÿ¢€åÿß ÿßÿ≤ ÿ≠ÿ∞ŸÅ ÿß€åŸÜ ÿØÿ±ÿ≥ ÿßÿ∑ŸÖ€åŸÜÿßŸÜ ÿØÿßÿ±€åÿØÿü')) {
                    try {
                        await supabase.from('courses').delete().eq('id', id);
                        await loadCoursesWithCache();
                    } catch (error) {
                        alert('ÿÆÿ∑ÿß ÿØÿ± ÿ≠ÿ∞ŸÅ: ' + error.message);
                    }
                }
            };

            window.saveCourse = async function() {
                const name = document.getElementById('courseName').value.trim();
                const code = document.getElementById('courseCode').value.trim() || '---';
                const dayIndex = parseInt(document.getElementById('courseDay').value);
                const startTime = document.getElementById('startTime').value;
                const endTime = document.getElementById('endTime').value;
                const professor = document.getElementById('professor').value.trim() || 'ŸÜÿßŸÖÿ¥ÿÆÿµ';
                const location = document.getElementById('location').value.trim() || 'ŸÜÿßŸÖÿ¥ÿÆÿµ';
                const courseGroup = document.getElementById('courseGroup').value.trim() || '---';
                const theoretical = parseFloat(document.getElementById('theoretical').value) || 0;
                const practical = parseFloat(document.getElementById('practical').value) || 0;
                const total = parseFloat(document.getElementById('total').value) || 0;
                const isOnline = document.getElementById('isOnline').checked;
                const onlineLink = document.getElementById('onlineLink').value.trim();

                if (!name || !startTime || !endTime) { alert('ŸÑÿ∑ŸÅÿßŸã ŸÜÿßŸÖ ÿØÿ±ÿ≥ Ÿà ÿ≥ÿßÿπÿ™ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ'); return; }

                const courseData = {
                    name, code, dayIndex, startTime, endTime,
                    theoretical, practical, total,
                    group_name: courseGroup, professor, location,
                    examDate: 'ŸÖÿ¥ÿÆÿµ ŸÜÿ¥ÿØŸá', examTime: '', examDuration: 'ŸÖÿ¥ÿÆÿµ ŸÜÿ¥ÿØŸá', examLocation: 'ŸÖÿ¥ÿÆÿµ ŸÜÿ¥ÿØŸá',
                    isOnline, onlineLink
                };

                const editId = document.getElementById('editId').value;
                try {
                    if (editId) {
                        await supabase.from('courses').update(courseData).eq('id', editId);
                    } else {
                        await supabase.from('courses').insert([courseData]);
                    }
                    cancelEdit();
                    await loadCoursesWithCache();
                } catch (error) {
                    alert('ÿÆÿ∑ÿß ÿØÿ± ÿ∞ÿÆ€åÿ±Ÿá: ' + error.message);
                }
            };

            window.cancelEdit = function() {
                document.getElementById('editId').value = '';
                document.getElementById('courseName').value = '';
                document.getElementById('courseCode').value = '';
                document.getElementById('startTime').value = '08:00';
                document.getElementById('endTime').value = '10:00';
                document.getElementById('professor').value = '';
                document.getElementById('location').value = '';
                document.getElementById('courseGroup').value = '---';
                document.getElementById('theoretical').value = '0.0';
                document.getElementById('practical').value = '0.0';
                document.getElementById('total').value = '0.0';
                document.getElementById('isOnline').checked = false;
                document.getElementById('onlineLink').value = '';
                document.getElementById('onlineLinkGroup').style.display = 'none';
                document.getElementById('formTitle').innerText = 'ÿßŸÅÿ≤ŸàÿØŸÜ ÿØÿ±ÿ≥ ÿ¨ÿØ€åÿØ';
                const adminSection = document.getElementById('adminSection');
                if (adminSection) adminSection.classList.remove('visible');
            };

            document.getElementById('isOnline').addEventListener('change', function(e) {
                document.getElementById('onlineLinkGroup').style.display = e.target.checked ? 'block' : 'none';
            });

            window.toggleCard = function(card) { card.classList.toggle('expanded'); };

            async function initApp() {
                setOfflineBanner(!navigator.onLine);
                await requestNotificationPermission();
                await checkAuthState();
                subscribeToSettings();
                loadCoursesWithCache();
                setInterval(updateCountdownsAndBell, 1000);
            }

            window.addEventListener('online', () => {
                setOfflineBanner(false);
                loadCoursesWithCache();
            });
            window.addEventListener('offline', () => {
                setOfflineBanner(true);
            });

            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js?v=8').then(() => {
                    return navigator.serviceWorker.ready;
                }).then(() => {
                    initApp();
                }).catch(() => {
                    initApp();
                });
            } else {
                initApp();
            }
        })();
    </script>
    <script>
        (function wallpaper() {
            var TEHRAN_OFFSET_MS = 3.5 * 60 * 60 * 1000;
            var QUALITY_KEY = 'wallpaperQuality';
            var BG_KEY = 'sceneBgUrl';
            var SCENE_KEY = 'sceneConfigV1';
            var DEFAULT_SCENE = {
                v: 1,
                desktop: {
                    arc: { minY: 18, maxY: 58, minX: 10, maxX: 90 },
                    clouds: [
                        { enabled: true, top: 15, right: 8, dur: 140, delay: 0 },
                        { enabled: true, top: 32, right: 45, dur: 160, delay: -50 },
                        { enabled: true, top: 22, right: 75, dur: 150, delay: -90 }
                    ],
                    trees: {
                        pos1: { enabled: true, side: 'right', offset: 6 },
                        pos2: { enabled: true, side: 'right', offset: 34 },
                        pos3: { enabled: true, side: 'left', offset: 8 }
                    }
                },
                mobile: {
                    arc: { minY: 16, maxY: 54, minX: 10, maxX: 90 },
                    clouds: [
                        { enabled: false, top: 15, right: 8, dur: 160, delay: 0 },
                        { enabled: false, top: 32, right: 45, dur: 180, delay: -50 },
                        { enabled: false, top: 22, right: 75, dur: 170, delay: -90 }
                    ],
                    trees: {
                        pos1: { enabled: true, side: 'right', offset: 4 },
                        pos2: { enabled: false, side: 'right', offset: 32 },
                        pos3: { enabled: true, side: 'left', offset: 5 }
                    }
                }
            };
            function getQuality() {
                var q = (typeof localStorage !== 'undefined' && localStorage.getItem(QUALITY_KEY)) || 'fast';
                return (q === 'medium' || q === 'high') ? q : 'fast';
            }
            function getPlatformKey() {
                return window.innerWidth <= 768 ? 'mobile' : 'desktop';
            }
            function getSceneConfig() {
                try {
                    var raw = (typeof localStorage !== 'undefined' && localStorage.getItem(SCENE_KEY)) || '';
                    if (raw) return JSON.parse(raw);
                } catch (e2) {}
                return DEFAULT_SCENE;
            }
            function getActiveScene() {
                var cfg = getSceneConfig();
                var key = getPlatformKey();
                return (cfg && cfg[key]) ? cfg[key] : DEFAULT_SCENE[key];
            }
            function applyQualityToUI() {
                var sel = document.getElementById('wallpaperQualitySelect');
                if (sel) sel.value = getQuality();
                document.body.classList.remove('quality-fast', 'quality-medium', 'quality-high');
                document.body.classList.add('quality-' + getQuality());
            }
            function applyBackgroundFromStorage() {
                try {
                    var url = (typeof localStorage !== 'undefined' && localStorage.getItem(BG_KEY)) || '';
                    var bg = document.getElementById('wallpaperBg');
                    if (!bg) return;
                    url = (url || '').trim();
                    if (!url) {
                        bg.style.display = 'none';
                        bg.src = '';
                        return;
                    }
                    bg.src = url;
                    bg.style.display = 'block';
                } catch (e) {}
            }
            function applySceneConfig() {
                var scene = getActiveScene();
                if (!scene) return;

                // Clouds
                try {
                    var c1 = document.querySelector('.dynamic-wallpaper .wp-cloud-1');
                    var c2 = document.querySelector('.dynamic-wallpaper .wp-cloud-2');
                    var c3 = document.querySelector('.dynamic-wallpaper .wp-cloud-3');
                    var clouds = [c1, c2, c3];
                    (scene.clouds || []).forEach(function (c, idx) {
                        var el = clouds[idx];
                        if (!el) return;
                        var enabled = !!c.enabled;
                        // cloud3 only when quality=high (unless disabled)
                        if (idx === 2 && getQuality() !== 'high') enabled = false;
                        el.style.display = enabled ? '' : 'none';
                        if (typeof c.top === 'number') el.style.top = c.top + '%';
                        if (typeof c.right === 'number') el.style.right = c.right + '%';
                        if (typeof c.dur === 'number') el.style.animationDuration = c.dur + 's';
                        if (typeof c.delay === 'number') el.style.animationDelay = c.delay + 's';
                    });
                } catch (e) {}

                // Trees
                try {
                    var t = scene.trees || {};
                    ['pos1', 'pos2', 'pos3'].forEach(function (pos) {
                        var rules = t[pos] || { enabled: true, side: 'right', offset: 10 };
                        var nodes = document.querySelectorAll('.dynamic-wallpaper .wp-tree-' + pos);
                        nodes.forEach(function (node) {
                            node.style.display = rules.enabled ? '' : 'none';
                            if (rules.side === 'left') {
                                node.style.left = (typeof rules.offset === 'number' ? rules.offset : 8) + '%';
                                node.style.right = '';
                            } else {
                                node.style.right = (typeof rules.offset === 'number' ? rules.offset : 8) + '%';
                                node.style.left = '';
                            }
                        });
                    });
                } catch (e2) {}
            }
            function getTehranNow() {
                return new Date(Date.now() + TEHRAN_OFFSET_MS);
            }
            function updateSunMoonPosition() {
                var d = getTehranNow();
                var hour = d.getUTCHours();
                var totalMinutes = hour * 60 + d.getUTCMinutes();
                var sunEl = document.getElementById('wallpaperSun');
                var moonEl = document.getElementById('wallpaperMoon');
                if (!sunEl || !moonEl) return;
                var isDay = hour >= 6 && hour < 18;
                var scene = getActiveScene();
                var arc = (scene && scene.arc) ? scene.arc : DEFAULT_SCENE[getPlatformKey()].arc;
                var arcMinY = typeof arc.minY === 'number' ? arc.minY : 18;
                var arcMaxY = typeof arc.maxY === 'number' ? arc.maxY : 58;
                var arcMinX = typeof arc.minX === 'number' ? arc.minX : 10;
                var arcMaxX = typeof arc.maxX === 'number' ? arc.maxX : 90;
                var arcRange = arcMaxY - arcMinY;
                var xRange = arcMaxX - arcMinX;
                if (isDay) {
                    var progress = Math.max(0, Math.min(1, (totalMinutes - 6 * 60) / (12 * 60)));
                    var x = arcMinX + progress * xRange;
                    var y = arcMaxY - Math.sin(progress * Math.PI) * arcRange;
                    sunEl.style.right = x + '%';
                    sunEl.style.top = y + '%';
                    sunEl.style.transform = 'translate(-50%, -50%)';
                    sunEl.style.opacity = progress < 0.06 ? (progress / 0.06) + '' : (progress > 0.94 ? (1 - progress) / 0.06 + '' : '1');
                } else {
                    var nightStart = 18 * 60;
                    var nightEnd = 30 * 60;
                    var currentInNight = totalMinutes >= nightStart ? totalMinutes - nightStart : (24 * 60 - nightStart) + totalMinutes;
                    var progress = Math.max(0, Math.min(1, currentInNight / (nightEnd - nightStart)));
                    var x = arcMinX + progress * xRange;
                    var y = arcMaxY - Math.sin(progress * Math.PI) * arcRange;
                    moonEl.style.right = x + '%';
                    moonEl.style.top = y + '%';
                    moonEl.style.transform = 'translate(-50%, -50%)';
                    moonEl.style.opacity = progress < 0.06 ? (progress / 0.06) + '' : (progress > 0.94 ? (1 - progress) / 0.06 + '' : '1');
                }
            }
            function updateTheme() {
                var theme = window.wallpaperThemeOverride;
                var season = window.wallpaperSeasonOverride;
                if (!theme || theme === 'auto') {
                    var hour = getTehranNow().getUTCHours();
                    theme = (hour < 6 || hour >= 18) ? 'night' : 'day';
                }
                if (!season || season === 'auto') {
                    var month = getTehranNow().getUTCMonth();
                    if (month >= 11 || month <= 1) season = 'winter';
                    else if (month >= 2 && month <= 4) season = 'spring';
                    else if (month >= 5 && month <= 7) season = 'summer';
                    else season = 'autumn';
                }
                document.body.classList.toggle('theme-day', theme === 'day');
                document.body.classList.toggle('theme-night', theme === 'night');
                document.body.classList.remove('season-winter', 'season-spring', 'season-summer', 'season-autumn');
                document.body.classList.add('season-' + season);
                updateSunMoonPosition();
            }
            function createStars() {
                var el = document.getElementById('starsContainer');
                if (!el) return;
                el.innerHTML = '';
                var q = getQuality();
                var isMobile = window.innerWidth <= 768;
                var count = isMobile
                    ? (q === 'fast' ? 12 : q === 'medium' ? 20 : 35)
                    : (q === 'fast' ? 22 : q === 'medium' ? 45 : 70);
                for (var i = 0; i < count; i++) {
                    var s = document.createElement('div');
                    s.className = 'star';
                    s.style.left = Math.random() * 100 + '%';
                    s.style.top = Math.random() * 65 + '%';
                    el.appendChild(s);
                }
            }
            function createParticles() {
                var el = document.getElementById('particlesContainer');
                if (!el) return;
                el.innerHTML = '';
                var q = getQuality();
                var isMobile = window.innerWidth <= 768;
                if (isMobile && q === 'fast') return;
                var season = '';
                if (document.body.classList.contains('season-winter')) season = 'winter';
                else if (document.body.classList.contains('season-spring')) season = 'spring';
                else if (document.body.classList.contains('season-summer')) season = 'leaf-summer';
                else if (document.body.classList.contains('season-autumn')) season = 'leaf-autumn';
                var winterN = q === 'fast' ? 12 : q === 'medium' ? 20 : 30;
                var springN = q === 'fast' ? 6 : q === 'medium' ? 10 : 15;
                var leafN = q === 'fast' ? 10 : q === 'medium' ? 18 : 25;
                if (isMobile) { winterN = Math.min(winterN, 8); springN = Math.min(springN, 5); leafN = Math.min(leafN, 6); }
                var n = (season === 'winter') ? winterN : (season === 'spring') ? springN : leafN;
                for (var i = 0; i < n; i++) {
                    var p = document.createElement('div');
                    p.className = 'particle';
                    p.style.left = Math.random() * 100 + '%';
                    p.style.setProperty('--dur', (14 + Math.random() * 8) + 's');
                    p.style.setProperty('--delay', (-Math.random() * 10) + 's');
                    p.style.setProperty('--r', (Math.random() * 360) + 'deg');
                    if (season === 'winter') p.classList.add('snowflake');
                    else if (season === 'spring') p.classList.add('petal');
                    else { p.classList.add('leaf'); if (season === 'leaf-summer') p.classList.add('spring'); }
                    el.appendChild(p);
                }
            }
            window.applyWallpaperPreview = function() {
                var themeEl = document.getElementById('wallpaperThemeSelect');
                var seasonEl = document.getElementById('wallpaperSeasonSelect');
                if (themeEl) window.wallpaperThemeOverride = themeEl.value === 'auto' ? null : themeEl.value;
                if (seasonEl) window.wallpaperSeasonOverride = seasonEl.value === 'auto' ? null : seasonEl.value;
                updateTheme();
                createParticles();
            };
            function onQualityChange() {
                var sel = document.getElementById('wallpaperQualitySelect');
                if (!sel) return;
                var val = (sel.value === 'medium' || sel.value === 'high') ? sel.value : 'fast';
                try { localStorage.setItem(QUALITY_KEY, val); } catch (e) {}
                document.body.classList.remove('quality-fast', 'quality-medium', 'quality-high');
                document.body.classList.add('quality-' + val);
                applySceneConfig();
                createStars();
                createParticles();
            }
            function init() {
                applyQualityToUI();
                var sel = document.getElementById('wallpaperQualitySelect');
                if (sel) sel.addEventListener('change', onQualityChange);
                updateTheme();
                applyBackgroundFromStorage();
                applySceneConfig();
                createStars();
                createParticles();
                updateSunMoonPosition();
                setInterval(updateTheme, 60000);
            }
            window.wallpaperApplyScene = function () {
                applySceneConfig();
                updateSunMoonPosition();
            };
            if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
            else init();
        })();
    </script>
    <script src="https://unpkg.com/lenis@1.3.11/dist/lenis.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof Lenis !== 'undefined') {
                var lenis = new Lenis({ lerp: 0.070, smoothWheel: true });
                function raf(time) {
                    lenis.raf(time);
                    requestAnimationFrame(raf);
                }
                requestAnimationFrame(raf);
            }
        });
    </script>
</body>
</html>
